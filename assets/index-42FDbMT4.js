(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const IS_DEV=!1,equalFn=(e,t)=>e===t,$PROXY=Symbol("solid-proxy"),$TRACK=Symbol("solid-track"),signalOptions={equals:equalFn};let runEffects=runQueue;const STALE=1,PENDING=2,UNOWNED={owned:null,cleanups:null,context:null,owner:null},NO_INIT={};var Owner=null;let Transition=null,ExternalSourceConfig=null,Listener=null,Updates=null,Effects=null,ExecCount=0;function createRoot(e,t){const n=Listener,r=Owner,a=e.length===0,o=t===void 0?r:t,s=a?UNOWNED:{owned:null,cleanups:null,context:o?o.context:null,owner:o},l=a?e:()=>e(()=>untrack(()=>cleanNode(s)));Owner=s,Listener=null;try{return runUpdates(l,!0)}finally{Listener=n,Owner=r}}function createSignal(e,t){t=t?Object.assign({},signalOptions,t):signalOptions;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=a=>(typeof a=="function"&&(a=a(n.value)),writeSignal(n,a));return[readSignal.bind(n),r]}function createComputed(e,t,n){const r=createComputation(e,t,!0,STALE);updateComputation(r)}function createRenderEffect(e,t,n){const r=createComputation(e,t,!1,STALE);updateComputation(r)}function createEffect(e,t,n){runEffects=runUserEffects;const r=createComputation(e,t,!1,STALE);r.user=!0,Effects?Effects.push(r):updateComputation(r)}function createMemo(e,t,n){n=n?Object.assign({},signalOptions,n):signalOptions;const r=createComputation(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,updateComputation(r),readSignal.bind(r)}function isPromise(e){return e&&typeof e=="object"&&"then"in e}function createResource(e,t,n){let r,a,o;typeof t=="function"?(r=e,a=t,o={}):(r=!0,a=e,o=t||{});let s=null,l=NO_INIT,f=!1,p="initialValue"in o,d=typeof r=="function"&&createMemo(r);const c=new Set,[_,$]=(o.storage||createSignal)(o.initialValue),[h,S]=createSignal(void 0),[A,O]=createSignal(void 0,{equals:!1}),[m,u]=createSignal(p?"ready":"unresolved");function g(y,w,P,N){return s===y&&(s=null,N!==void 0&&(p=!0),(y===l||w===l)&&o.onHydrated&&queueMicrotask(()=>o.onHydrated(N,{value:w})),l=NO_INIT,b(w,P)),w}function b(y,w){runUpdates(()=>{w===void 0&&$(()=>y),u(w!==void 0?"errored":p?"ready":"unresolved"),S(w);for(const P of c.keys())P.decrement();c.clear()},!1)}function T(){const y=SuspenseContext,w=_(),P=h();if(P!==void 0&&!s)throw P;return Listener&&Listener.user,w}function E(y=!0){if(y!==!1&&f)return;f=!1;const w=d?d():r;if(w==null||w===!1){g(s,untrack(_));return}const P=l!==NO_INIT?l:untrack(()=>a(w,{value:_(),refetching:y}));return isPromise(P)?(s=P,"value"in P?(P.status==="success"?g(s,P.value,void 0,w):g(s,void 0,castError(P.value),w),P):(f=!0,queueMicrotask(()=>f=!1),runUpdates(()=>{u(p?"refreshing":"pending"),O()},!1),P.then(N=>g(P,N,void 0,w),N=>g(P,void 0,castError(N),w)))):(g(s,P,void 0,w),P)}return Object.defineProperties(T,{state:{get:()=>m()},error:{get:()=>h()},loading:{get(){const y=m();return y==="pending"||y==="refreshing"}},latest:{get(){if(!p)return T();const y=h();if(y&&!s)throw y;return _()}}}),d?createComputed(()=>E(!1)):E(!1),[T,{refetch:E,mutate:$}]}function batch(e){return runUpdates(e,!1)}function untrack(e){if(Listener===null)return e();const t=Listener;Listener=null;try{return e()}finally{Listener=t}}function onMount(e){createEffect(()=>untrack(e))}function onCleanup(e){return Owner===null||(Owner.cleanups===null?Owner.cleanups=[e]:Owner.cleanups.push(e)),e}function getListener(){return Listener}const[transPending,setTransPending]=createSignal(!1);let SuspenseContext;function readSignal(){if(this.sources&&this.state)if(this.state===STALE)updateComputation(this);else{const e=Updates;Updates=null,runUpdates(()=>lookUpstream(this),!1),Updates=e}if(Listener){const e=this.observers?this.observers.length:0;Listener.sources?(Listener.sources.push(this),Listener.sourceSlots.push(e)):(Listener.sources=[this],Listener.sourceSlots=[e]),this.observers?(this.observers.push(Listener),this.observerSlots.push(Listener.sources.length-1)):(this.observers=[Listener],this.observerSlots=[Listener.sources.length-1])}return this.value}function writeSignal(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&runUpdates(()=>{for(let a=0;a<e.observers.length;a+=1){const o=e.observers[a],s=Transition&&Transition.running;s&&Transition.disposed.has(o),(s?!o.tState:!o.state)&&(o.pure?Updates.push(o):Effects.push(o),o.observers&&markDownstream(o)),s||(o.state=STALE)}if(Updates.length>1e6)throw Updates=[],new Error},!1)),t}function updateComputation(e){if(!e.fn)return;cleanNode(e);const t=ExecCount;runComputation(e,e.value,t)}function runComputation(e,t,n){let r;const a=Owner,o=Listener;Listener=Owner=e;try{r=e.fn(t)}catch(s){return e.pure&&(e.state=STALE,e.owned&&e.owned.forEach(cleanNode),e.owned=null),e.updatedAt=n+1,handleError(s)}finally{Listener=o,Owner=a}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?writeSignal(e,r):e.value=r,e.updatedAt=n)}function createComputation(e,t,n,r=STALE,a){const o={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:Owner,context:Owner?Owner.context:null,pure:n};return Owner===null||Owner!==UNOWNED&&(Owner.owned?Owner.owned.push(o):Owner.owned=[o]),o}function runTop(e){if(e.state===0)return;if(e.state===PENDING)return lookUpstream(e);if(e.suspense&&untrack(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ExecCount);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===STALE)updateComputation(e);else if(e.state===PENDING){const r=Updates;Updates=null,runUpdates(()=>lookUpstream(e,t[0]),!1),Updates=r}}function runUpdates(e,t){if(Updates)return e();let n=!1;t||(Updates=[]),Effects?n=!0:Effects=[],ExecCount++;try{const r=e();return completeUpdates(n),r}catch(r){n||(Effects=null),Updates=null,handleError(r)}}function completeUpdates(e){if(Updates&&(runQueue(Updates),Updates=null),e)return;const t=Effects;Effects=null,t.length&&runUpdates(()=>runEffects(t),!1)}function runQueue(e){for(let t=0;t<e.length;t++)runTop(e[t])}function runUserEffects(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:runTop(r)}for(t=0;t<n;t++)runTop(e[t])}function lookUpstream(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const a=r.state;a===STALE?r!==t&&(!r.updatedAt||r.updatedAt<ExecCount)&&runTop(r):a===PENDING&&lookUpstream(r,t)}}}function markDownstream(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=PENDING,n.pure?Updates.push(n):Effects.push(n),n.observers&&markDownstream(n))}}function cleanNode(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),a=n.observers;if(a&&a.length){const o=a.pop(),s=n.observerSlots.pop();r<a.length&&(o.sourceSlots[s]=r,a[r]=o,n.observerSlots[r]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)cleanNode(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)cleanNode(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function castError(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function handleError(e,t=Owner){throw castError(e)}const FALLBACK=Symbol("fallback");function dispose(e){for(let t=0;t<e.length;t++)e[t]()}function mapArray(e,t,n={}){let r=[],a=[],o=[],s=0,l=t.length>1?[]:null;return onCleanup(()=>dispose(o)),()=>{let f=e()||[],p=f.length,d,c;return f[$TRACK],untrack(()=>{let $,h,S,A,O,m,u,g,b;if(p===0)s!==0&&(dispose(o),o=[],r=[],a=[],s=0,l&&(l=[])),n.fallback&&(r=[FALLBACK],a[0]=createRoot(T=>(o[0]=T,n.fallback())),s=1);else if(s===0){for(a=new Array(p),c=0;c<p;c++)r[c]=f[c],a[c]=createRoot(_);s=p}else{for(S=new Array(p),A=new Array(p),l&&(O=new Array(p)),m=0,u=Math.min(s,p);m<u&&r[m]===f[m];m++);for(u=s-1,g=p-1;u>=m&&g>=m&&r[u]===f[g];u--,g--)S[g]=a[u],A[g]=o[u],l&&(O[g]=l[u]);for($=new Map,h=new Array(g+1),c=g;c>=m;c--)b=f[c],d=$.get(b),h[c]=d===void 0?-1:d,$.set(b,c);for(d=m;d<=u;d++)b=r[d],c=$.get(b),c!==void 0&&c!==-1?(S[c]=a[d],A[c]=o[d],l&&(O[c]=l[d]),c=h[c],$.set(b,c)):o[d]();for(c=m;c<p;c++)c in S?(a[c]=S[c],o[c]=A[c],l&&(l[c]=O[c],l[c](c))):a[c]=createRoot(_);a=a.slice(0,s=p),r=f.slice(0)}return a});function _($){if(o[c]=$,l){const[h,S]=createSignal(c);return l[c]=S,t(f[c],h)}return t(f[c])}}}function createComponent(e,t){return untrack(()=>e(t||{}))}const narrowedError=e=>`Stale read from <${e}>.`;function For(e){const t="fallback"in e&&{fallback:()=>e.fallback};return createMemo(mapArray(()=>e.each,e.children,t||void 0))}function Show(e){const t=e.keyed,n=createMemo(()=>e.when,void 0,void 0),r=t?n:createMemo(n,void 0,{equals:(a,o)=>!a==!o});return createMemo(()=>{const a=r();if(a){const o=e.children;return typeof o=="function"&&o.length>0?untrack(()=>o(t?a:()=>{if(!untrack(r))throw narrowedError("Show");return n()})):o}return e.fallback},void 0,void 0)}function reconcileArrays(e,t,n){let r=n.length,a=t.length,o=r,s=0,l=0,f=t[a-1].nextSibling,p=null;for(;s<a||l<o;){if(t[s]===n[l]){s++,l++;continue}for(;t[a-1]===n[o-1];)a--,o--;if(a===s){const d=o<r?l?n[l-1].nextSibling:n[o-l]:f;for(;l<o;)e.insertBefore(n[l++],d)}else if(o===l)for(;s<a;)(!p||!p.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[o-1]&&n[l]===t[a-1]){const d=t[--a].nextSibling;e.insertBefore(n[l++],t[s++].nextSibling),e.insertBefore(n[--o],d),t[a]=n[o]}else{if(!p){p=new Map;let c=l;for(;c<o;)p.set(n[c],c++)}const d=p.get(t[s]);if(d!=null)if(l<d&&d<o){let c=s,_=1,$;for(;++c<a&&c<o&&!(($=p.get(t[c]))==null||$!==d+_);)_++;if(_>d-l){const h=t[s];for(;l<d;)e.insertBefore(n[l++],h)}else e.replaceChild(n[l++],t[s++])}else s++;else t[s++].remove()}}}const $$EVENTS="_$DX_DELEGATE";function render(e,t,n,r={}){let a;return createRoot(o=>{a=o,t===document?e():insert(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{a(),t.textContent=""}}function template(e,t,n,r){let a;const o=()=>{const l=document.createElement("template");return l.innerHTML=e,l.content.firstChild},s=()=>(a||(a=o())).cloneNode(!0);return s.cloneNode=s,s}function delegateEvents(e,t=window.document){const n=t[$$EVENTS]||(t[$$EVENTS]=new Set);for(let r=0,a=e.length;r<a;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,eventHandler))}}function setAttribute(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function className(e,t){t==null?e.removeAttribute("class"):e.className=t}function addEventListener(e,t,n,r){if(Array.isArray(n)){const a=n[0];e.addEventListener(t,n[0]=o=>a.call(e,n[1],o))}else e.addEventListener(t,n,typeof n!="function"&&n)}function style(e,t,n){if(!t)return n?setAttribute(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let a,o;for(o in n)t[o]==null&&r.removeProperty(o),delete n[o];for(o in t)a=t[o],a!==n[o]&&(r.setProperty(o,a),n[o]=a);return n}function use(e,t,n){return untrack(()=>e(t,n))}function insert(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return insertExpression(e,t,r,n);createRenderEffect(a=>insertExpression(e,t(),a,n),r)}function eventHandler(e){let t=e.target;const n=`$$${e.type}`,r=e.target,a=e.currentTarget,o=f=>Object.defineProperty(e,"target",{configurable:!0,value:f}),s=()=>{const f=t[n];if(f&&!t.disabled){const p=t[`${n}Data`];if(p!==void 0?f.call(t,p,e):f.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&o(t.host),!0},l=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const f=e.composedPath();o(f[0]);for(let p=0;p<f.length-2&&(t=f[p],!!s());p++){if(t._$host){t=t._$host,l();break}if(t.parentNode===a)break}}else l();o(r)}function insertExpression(e,t,n,r,a){for(;typeof n=="function";)n=n();if(t===n)return n;const o=typeof t,s=r!==void 0;if(e=s&&n[0]&&n[0].parentNode||e,o==="string"||o==="number"){if(o==="number"&&(t=t.toString(),t===n))return n;if(s){let l=n[0];l&&l.nodeType===3?l.data!==t&&(l.data=t):l=document.createTextNode(t),n=cleanChildren(e,n,r,l)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||o==="boolean")n=cleanChildren(e,n,r);else{if(o==="function")return createRenderEffect(()=>{let l=t();for(;typeof l=="function";)l=l();n=insertExpression(e,l,n,r)}),()=>n;if(Array.isArray(t)){const l=[],f=n&&Array.isArray(n);if(normalizeIncomingArray(l,t,n,a))return createRenderEffect(()=>n=insertExpression(e,l,n,r,!0)),()=>n;if(l.length===0){if(n=cleanChildren(e,n,r),s)return n}else f?n.length===0?appendNodes(e,l,r):reconcileArrays(e,n,l):(n&&cleanChildren(e),appendNodes(e,l));n=l}else if(t.nodeType){if(Array.isArray(n)){if(s)return n=cleanChildren(e,n,r,t);cleanChildren(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function normalizeIncomingArray(e,t,n,r){let a=!1;for(let o=0,s=t.length;o<s;o++){let l=t[o],f=n&&n[e.length],p;if(!(l==null||l===!0||l===!1))if((p=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))a=normalizeIncomingArray(e,l,f)||a;else if(p==="function")if(r){for(;typeof l=="function";)l=l();a=normalizeIncomingArray(e,Array.isArray(l)?l:[l],Array.isArray(f)?f:[f])||a}else e.push(l),a=!0;else{const d=String(l);f&&f.nodeType===3&&f.data===d?e.push(f):e.push(document.createTextNode(d))}}return a}function appendNodes(e,t,n=null){for(let r=0,a=t.length;r<a;r++)e.insertBefore(t[r],n)}function cleanChildren(e,t,n,r){if(n===void 0)return e.textContent="";const a=r||document.createTextNode("");if(t.length){let o=!1;for(let s=t.length-1;s>=0;s--){const l=t[s];if(a!==l){const f=l.parentNode===e;!o&&!s?f?e.replaceChild(a,l):e.insertBefore(a,n):f&&l.remove()}else o=!0}}else e.insertBefore(a,n);return[a]}const $RAW=Symbol("store-raw"),$NODE=Symbol("store-node"),$HAS=Symbol("store-has"),$SELF=Symbol("store-self");function wrap$1(e){let t=e[$PROXY];if(!t&&(Object.defineProperty(e,$PROXY,{value:t=new Proxy(e,proxyTraps$1)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let a=0,o=n.length;a<o;a++){const s=n[a];r[s].get&&Object.defineProperty(e,s,{enumerable:r[s].enumerable,get:r[s].get.bind(t)})}}return t}function isWrappable(e){let t;return e!=null&&typeof e=="object"&&(e[$PROXY]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function unwrap(e,t=new Set){let n,r,a,o;if(n=e!=null&&e[$RAW])return n;if(!isWrappable(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,l=e.length;s<l;s++)a=e[s],(r=unwrap(a,t))!==a&&(e[s]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let f=0,p=s.length;f<p;f++)o=s[f],!l[o].get&&(a=e[o],(r=unwrap(a,t))!==a&&(e[o]=r))}return e}function getNodes(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function getNode(e,t,n){if(e[t])return e[t];const[r,a]=createSignal(n,{equals:!1,internal:!0});return r.$=a,e[t]=r}function proxyDescriptor$1(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===$PROXY||t===$NODE||(delete n.value,delete n.writable,n.get=()=>e[$PROXY][t]),n}function trackSelf(e){getListener()&&getNode(getNodes(e,$NODE),$SELF)()}function ownKeys(e){return trackSelf(e),Reflect.ownKeys(e)}const proxyTraps$1={get(e,t,n){if(t===$RAW)return e;if(t===$PROXY)return n;if(t===$TRACK)return trackSelf(e),n;const r=getNodes(e,$NODE),a=r[t];let o=a?a():e[t];if(t===$NODE||t===$HAS||t==="__proto__")return o;if(!a){const s=Object.getOwnPropertyDescriptor(e,t);getListener()&&(typeof o!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(o=getNode(r,t,o)())}return isWrappable(o)?wrap$1(o):o},has(e,t){return t===$RAW||t===$PROXY||t===$TRACK||t===$NODE||t===$HAS||t==="__proto__"?!0:(getListener()&&getNode(getNodes(e,$HAS),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys,getOwnPropertyDescriptor:proxyDescriptor$1};function setProperty(e,t,n,r=!1){if(!r&&e[t]===n)return;const a=e[t],o=e.length;n===void 0?(delete e[t],e[$HAS]&&e[$HAS][t]&&a!==void 0&&e[$HAS][t].$()):(e[t]=n,e[$HAS]&&e[$HAS][t]&&a===void 0&&e[$HAS][t].$());let s=getNodes(e,$NODE),l;if((l=getNode(s,t,a))&&l.$(()=>n),Array.isArray(e)&&e.length!==o){for(let f=e.length;f<o;f++)(l=s[f])&&l.$();(l=getNode(s,"length",o))&&l.$(e.length)}(l=s[$SELF])&&l.$()}function mergeStoreNode(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const a=n[r];setProperty(e,a,t[a])}}function updateArray(e,t){if(typeof t=="function"&&(t=t(e)),t=unwrap(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const a=t[n];e[n]!==a&&setProperty(e,n,a)}setProperty(e,"length",r)}else mergeStoreNode(e,t)}function updatePath(e,t,n=[]){let r,a=e;if(t.length>1){r=t.shift();const s=typeof r,l=Array.isArray(e);if(Array.isArray(r)){for(let f=0;f<r.length;f++)updatePath(e,[r[f]].concat(t),n);return}else if(l&&s==="function"){for(let f=0;f<e.length;f++)r(e[f],f)&&updatePath(e,[f].concat(t),n);return}else if(l&&s==="object"){const{from:f=0,to:p=e.length-1,by:d=1}=r;for(let c=f;c<=p;c+=d)updatePath(e,[c].concat(t),n);return}else if(t.length>1){updatePath(e[r],t,[r].concat(n));return}a=e[r],n=[r].concat(n)}let o=t[0];typeof o=="function"&&(o=o(a,n),o===a)||r===void 0&&o==null||(o=unwrap(o),r===void 0||isWrappable(a)&&isWrappable(o)&&!Array.isArray(o)?mergeStoreNode(a,o):setProperty(e,r,o))}function createStore(...[e,t]){const n=unwrap(e||{}),r=Array.isArray(n),a=wrap$1(n);function o(...s){batch(()=>{r&&s.length===1?updateArray(n,s[0]):updatePath(n,s)})}return[a,o]}const producers=new WeakMap,setterTraps={get(e,t){if(t===$RAW)return e;const n=e[t];let r;return isWrappable(n)?producers.get(n)||(producers.set(n,r=new Proxy(n,setterTraps)),r):n},set(e,t,n){return setProperty(e,t,unwrap(n)),!0},deleteProperty(e,t){return setProperty(e,t,void 0,!0),!0}};function produce(e){return t=>{if(isWrappable(t)){let n;(n=producers.get(t))||producers.set(t,n=new Proxy(t,setterTraps)),e(n)}return t}}const createEmptyEffect=()=>({type:"Empty",params:{}}),MASTER_VOLUME_MAX=100,MASTER_VOLUME_MIN=0,WAVEFORM_NAMES=["sine","saw","square","triangle","noise","input"],WAVEFORM_IDS={SINE:0,TRIANGLE:1,SQUARE:2,SAW:3,NOISE:4,INPUT:5},WAVEFORM_ID_TO_NAME={[WAVEFORM_IDS.SINE]:"sine",[WAVEFORM_IDS.SAW]:"saw",[WAVEFORM_IDS.SQUARE]:"square",[WAVEFORM_IDS.TRIANGLE]:"triangle",[WAVEFORM_IDS.NOISE]:"noise",[WAVEFORM_IDS.INPUT]:"input"},WAVEFORM_NAME_TO_ID={sine:WAVEFORM_IDS.SINE,saw:WAVEFORM_IDS.SAW,square:WAVEFORM_IDS.SQUARE,triangle:WAVEFORM_IDS.TRIANGLE,noise:WAVEFORM_IDS.NOISE,input:WAVEFORM_IDS.INPUT},envelopeParamsInfo=[{key:"attack",label:"Attack:",min:0,max:10,step:.01,minDecimals:2},{key:"decay",label:"Decay:",min:0,max:10,step:.01,minDecimals:2},{key:"sustain",label:"Sustain:",min:0,max:1,step:.01,minDecimals:2},{key:"release",label:"Release:",min:0,max:10,step:.01,minDecimals:2}],FILTERS=[{name:"Low Pass",type:"LowPass",value:0,params:[{name:"Cutoff",id:"cutoff",default:2e4,min:20,max:2e4,step:1,unit:"Hz"},{name:"Q",id:"q",default:.707,min:.1,max:10,step:.01,unit:""}]},{name:"Comb",type:"Comb",value:1,params:[{name:"Alpha",id:"alpha",default:.5,min:-1,max:1,step:.01,unit:""},{name:"K",id:"k",default:100,min:1,max:4096,step:1,unit:"samples"}]},{name:"Pitched Comb",type:"PitchedComb",value:2,params:[{name:"Alpha",id:"alpha",default:.95,min:-1,max:1,step:.01,unit:""}]}],NUM_OPERATORS=6;let audioCtx=null;function getAudioContext(){if(!audioCtx)try{audioCtx=new AudioContext,console.log("AudioContext created. Sample rate:",audioCtx.sampleRate),audioCtx.state==="suspended"&&console.warn("AudioContext is suspended. User interaction (e.g., click/keypress) is required to start audio.")}catch(e){throw console.error("Failed to create AudioContext:",e),new Error("Could not create AudioContext. Web Audio API may not be supported.")}return audioCtx}function resumeAudioContext(){audioCtx&&audioCtx.state==="suspended"&&(console.log("Attempting to resume AudioContext..."),audioCtx.resume().then(()=>{console.log("AudioContext resumed successfully.")}).catch(e=>console.warn("AudioContext.resume() failed:",e)))}function closeAudioContext(){if(audioCtx){const e=audioCtx;audioCtx=null,e.close().then(()=>{console.log("AudioContext closed.")}).catch(t=>{console.error("Error closing AudioContext:",t)})}}function createAudioWorkletNode(e,t){const n=getAudioContext();try{const r=new AudioWorkletNode(n,e,t);return console.log(`AudioWorkletNode '${e}' created.`),r}catch(r){throw console.error(`Failed to create AudioWorkletNode '${e}':`,r),r}}async function addAudioWorkletModule(e){const t=getAudioContext();try{await t.audioWorklet.addModule(e),console.log(`AudioWorklet module loaded from: ${e}`)}catch(n){throw console.error(`Failed to load AudioWorklet module from ${e}:`,n),n}}function clampValue(e,t,n){return Math.max(t,Math.min(n,e))}function objToJsonBytes(e){const t=JSON.stringify(e);return new TextEncoder().encode(t)}function stringToBytes(e){return new TextEncoder().encode(e)}function u8ArrayToBinaryString(e){let t="";const n=e.length;for(let r=0;r<n;r++)t+=String.fromCharCode(e[r]);return t}function binaryStringToU8Array(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n}function formatNumberToMinDecimals(e,t){if((e==null||isNaN(e))&&(e=e??0,isNaN(e)))return"NaN";t=Math.max(0,Math.floor(t));const n=String(e),r=n.indexOf(".");if(r===-1)return t===0?n:`${n}.${"0".repeat(t)}`;{const a=n.length-r-1;if(a>=t)return n;{const o=t-a;return`${n}${"0".repeat(o)}`}}}const DEFAULT_ENVELOPE_STATE={attack:.001,decay:1,sustain:.6,release:.1};function createDefaultOperatorState(){return{ratio:1,fixedFrequency:0,detune:0,modulationIndex:10,waveform:0,envelope:{...DEFAULT_ENVELOPE_STATE},filters:[]}}function createDefaultAlgorithmMatrixState(){const e=NUM_OPERATORS,t=NUM_OPERATORS+1,n=[];for(let r=0;r<e;r++){const a=Array(t).fill(0);r===0&&(a[t-1]=1),n.push(a)}return n}function createDefaultAppState(){return console.log("Creating default app state..."),{algorithm:createDefaultAlgorithmMatrixState(),operators:Array(NUM_OPERATORS).fill(null).map(()=>createDefaultOperatorState()),masterVolume:80,effects:[createEmptyEffect(),createEmptyEffect(),createEmptyEffect()]}}function fillMissingAppState(e){const t=createDefaultAppState();return{algorithm:fillMatrix(e.algorithm,t.algorithm),operators:fillOperators(e.operators,t.operators),masterVolume:e.masterVolume??t.masterVolume,effects:fillMissingEffects(e.effects,t.effects)}}function fillMissingEffects(e,t){if(!Array.isArray(e))return t;let n=[];for(let r=0;r<t.length;r++)r<e.length&&e[r]?n.push(e[r]):n.push(t[r]||createEmptyEffect());return n}function fillMatrix(e,t){if(!Array.isArray(e))return t;const n=[];for(let r=0;r<NUM_OPERATORS;r++){const a=t[r],o=e[r]||[],s=a.map((l,f)=>o[f]??l);n.push(s)}return n}function fillOperators(e,t){const n=[];for(let r=0;r<NUM_OPERATORS;r++){const a=e?.[r]??{},o=t[r];n.push({ratio:a.ratio??o.ratio,fixedFrequency:a.fixedFrequency??o.fixedFrequency,detune:a.detune??o.detune,modulationIndex:a.modulationIndex??o.modulationIndex,waveform:a.waveform??o.waveform,filters:a.filters??o.filters,envelope:{attack:a.envelope?.attack??DEFAULT_ENVELOPE_STATE.attack,decay:a.envelope?.decay??DEFAULT_ENVELOPE_STATE.decay,sustain:a.envelope?.sustain??DEFAULT_ENVELOPE_STATE.sustain,release:a.envelope?.release??DEFAULT_ENVELOPE_STATE.release}})}return n}let processorPort=null;function initializeSynthInputHandler(e){if(!e){console.error("SynthInputHandler: Received invalid port."),processorPort=null;return}console.log("SynthInputHandler: Port connected."),processorPort=e}function noteOn(e){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot send note_on.");return}resumeAudioContext();try{processorPort.postMessage({type:"note_on",note:e.noteNumber,velocity:e.velocity})}catch(t){console.error("SynthInputHandler: Error sending note_on:",t)}}function noteOff(e){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot send note_off.");return}try{processorPort.postMessage({type:"note_off",note:e.noteNumber})}catch(t){console.error("SynthInputHandler: Error sending note_off:",t)}}function setAlgorithm(e){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set algorithm.");return}try{processorPort.postMessage({type:"set_algorithm",matrix:e})}catch(t){console.error("SynthInputHandler: Error setting algorithm:",t)}}function setEffectReverb(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set reverb.");return}try{let n=objToJsonBytes(e);processorPort.postMessage({type:"set_effect_reverb",reverbParams:n,effectSlot:t})}catch(n){console.error("SynthInputHandler: Error setting reverb:",n)}}function removeEffect(e){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot remove effect.");return}try{processorPort.postMessage({type:"remove_effect",effectSlot:e})}catch(t){console.error("SynthInputHandler: Error removing effect:",t)}}function setOperatorRatio(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set ratio.");return}try{processorPort.postMessage({type:"set_operator_ratio",operatorIndex:e,ratio:t})}catch(n){console.error("SynthInputHandler: Error setting ratio:",n)}}function setOperatorFixedFrequency(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set fixed frequency.");return}try{processorPort.postMessage({type:"set_operator_fixed_frequency",operatorIndex:e,frequency:t})}catch(n){console.error("SynthInputHandler: Error setting fixed frequency:",n)}}function setOperatorDetune(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set detune.");return}try{processorPort.postMessage({type:"set_operator_detune",operatorIndex:e,detune:t})}catch(n){console.error("SynthInputHandler: Error setting fixed frequency:",n)}}function setOperatorModIndex(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set modulation index.");return}try{let r=Math.sign(t)*10*Math.pow(t/10,2);processorPort.postMessage({type:"set_operator_modulation_index",operatorIndex:e,modIndex:r})}catch(n){console.error("SynthInputHandler: Error setting modulation index:",n)}}function setOperatorWaveform(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set waveform.");return}try{processorPort.postMessage({type:"set_operator_waveform",operatorIndex:e,waveformId:t})}catch(n){console.error("SynthInputHandler: Error setting waveform:",n)}}function setOperatorEnvelope(e,t,n,r,a){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set envelope.");return}try{processorPort.postMessage({type:"set_operator_envelope",operatorIndex:e,attack:t,decay:n,sustain:r,release:a})}catch(o){console.error("SynthInputHandler: Error setting envelope:",o)}}function setOperatorFilter(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set filter.");return}try{processorPort.postMessage({type:"set_operator_filter",operatorIndex:e,filterParams:t})}catch(n){console.error("SynthInputHandler: Error setting filter:",n)}}function removeOperatorFilter(e,t){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set filter.");return}try{processorPort.postMessage({type:"remove_operator_filter",operatorIndex:e,filterType:t})}catch(n){console.error("SynthInputHandler: Error removing filter:",n)}}function setMasterVolume(e){if(!processorPort){console.warn("SynthInputHandler: Port not connected, cannot set volume.");return}try{const n=-60*(1-e/100),r=Math.pow(10,n/20);processorPort.postMessage({type:"set_master_volume",volume:r})}catch(t){console.error("SynthInputHandler: Error setting volume:",t)}}function setSynthState(e){if(console.log("SynthInputHandler: Setting full synth state..."),!processorPort){console.error("SynthInputHandler: Cannot set full state, port not connected.");return}e=fillMissingAppState(e),setMasterVolume(e.masterVolume),setAlgorithm(e.algorithm),e.effects.forEach((t,n)=>{let r=n+1;t.type==="Reverb"&&setEffectReverb(t.params,r),t.type==="Empty"&&removeEffect(r)}),e.operators.forEach((t,n)=>{console.log(`SynthInputHandler: Setting state for Operator ${n}`),setOperatorRatio(n,t.ratio),t.fixedFrequency!==0&&setOperatorFixedFrequency(n,t.fixedFrequency),setOperatorModIndex(n,t.modulationIndex),setOperatorWaveform(n,t.waveform),setOperatorEnvelope(n,t.envelope.attack,t.envelope.decay,t.envelope.sustain,t.envelope.release),setOperatorDetune(n,t.detune),FILTERS.forEach(r=>{const a=stringToBytes(r.type);a&&removeOperatorFilter(n,a)}),t.filters.forEach(r=>{const a=objToJsonBytes(r);a?setOperatorFilter(n,a):console.warn(`SynthInputHandler: Failed to encode parameters for filter type ${r.type} on operator ${n}`)})}),console.log("SynthInputHandler: Full synth state update complete.")}const NOTE_OFF_COMMAND=128,NOTE_ON_COMMAND=144;class MidiInputHandler{midiAccess=null;constructor(){this.init()}async init(){if(!navigator.requestMIDIAccess){console.warn("Web MIDI API not supported.");return}try{this.midiAccess=await navigator.requestMIDIAccess(),console.log("MIDI access granted."),this.setupMidiInput()}catch(t){console.error("Failed to get MIDI access:",t)}}setupMidiInput(){if(!this.midiAccess)return;const t=this.midiAccess.inputs;if(t.size===0){console.log("No MIDI input devices found.");return}t.forEach(n=>{n.onmidimessage=this.handleMidiMessage.bind(this),console.log(`MIDI input connected: ${n.name}`)})}handleMidiMessage(t){if(!t.data||t.data.length<3)return;const[n,r,a]=t.data,o=n&240;o===NOTE_OFF_COMMAND||o===NOTE_ON_COMMAND&&a===0?noteOff({noteNumber:r,velocity:0,source:"midi"}):o===NOTE_ON_COMMAND&&noteOn({noteNumber:r,velocity:a,source:"midi"})}}const NOTE_NAMES=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],KEYS_SHARPS=["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft"],KEYS_NATURAL=["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon"];function getNoteNameFromNote(e){return e<0||e>127?"":NOTE_NAMES[e%12]+(Math.floor(e/12)-1)}function getKeyboardLayoutData(e=48){let t=Math.max(0,Math.min(127,e)),n={},r=t,a=0,o=0;for(;!getNoteNameFromNote(r).includes("#")&&o<KEYS_NATURAL.length||getNoteNameFromNote(r).includes("#")&&a<KEYS_SHARPS.length;)getNoteNameFromNote(r).includes("#")?n[KEYS_SHARPS[a++]]={note:r}:(n[KEYS_NATURAL[o++]]={note:r},a=o),r++;const s=n.KeyA;n.KeyQ===void 0&&s&&getNoteNameFromNote(s.note-1).includes("#")&&(t--,t=Math.max(0,Math.min(127,t)));const l=t,f={};let p=l,d=0,c=0;for(;!getNoteNameFromNote(p).includes("#")&&c<KEYS_NATURAL.length||getNoteNameFromNote(p).includes("#")&&d<KEYS_SHARPS.length;){const $=getNoteNameFromNote(p);let h="",S="white";$.includes("#")?(h=KEYS_SHARPS[d++],S="black"):(h=KEYS_NATURAL[c++],S="white",d=c),h&&(f[h]={keyCode:h,note:p,noteName:$,type:S}),p++}return{keys:Object.entries(f).map(([$,h])=>h).sort(($,h)=>$.note-h.note),actualStartNote:l}}var _tmpl$$d=template("<div id=bottom-row class=bottom-row-controls><button id=shift-keys-left class=shift-keys>←</button><div id=keyboard-container class=keyboard-container></div><button id=shift-keys-right class=shift-keys>→"),_tmpl$2$6=template("<div><div class=key-label><span class=note-name></span><span class=key-code>");const KeyboardUI=e=>{const t=e.activeNotes,n=e.setActiveNotes,[r,a]=createSignal(e.initialStartNote??48),[o,s]=createSignal({keys:[],actualStartNote:e.initialStartNote??48}),[l,f]=createSignal({whiteWidth:10,blackWidth:6});createEffect(()=>{const u=getKeyboardLayoutData(r()),g=untrack(()=>t());g.length>0&&(console.log("Keyboard Shift: Stopping UI notes:",g),g.forEach(b=>{noteOff(b)}),n([])),s(u),u.actualStartNote!==r()&&untrack(()=>a(u.actualStartNote))}),onMount(()=>{try{const u=getComputedStyle(document.documentElement),g=parseFloat(u.getPropertyValue("--white-key-width"))||10,b=parseFloat(u.getPropertyValue("--black-key-width"))||6;f({whiteWidth:g,blackWidth:b})}catch(u){console.error("Could not read key dimensions from CSS.",u)}window.addEventListener("keydown",_),window.addEventListener("keyup",$),window.addEventListener("blur",h)}),onCleanup(()=>{window.removeEventListener("keydown",_),window.removeEventListener("keyup",$),window.removeEventListener("blur",h);const u=t();u.length>0&&(console.log("Keyboard Cleanup: Stopping UI notes:",u),u.forEach(g=>{noteOff(g)}))});const p=(u,g)=>t().some(b=>b.noteNumber===u&&b.source===g),d=(u,g)=>{g.preventDefault();const{note:b,keyCode:T}=u,E=100,y="pointer";if(!p(b,y)){const w={noteNumber:b,velocity:E,source:y};n([...t(),w]),noteOn(w)}},c=(u,g)=>{const{note:b,keyCode:T}=u,E="pointer";if(p(b,E)){const y={noteNumber:b,velocity:0,source:E};n(w=>w.filter(P=>!(P.noteNumber===b&&P.source===E))),noteOff(y)}},_=u=>{if(u.repeat)return;const g=u.target;if(g&&(g.tagName==="INPUT"||g.tagName==="TEXTAREA")&&g.hasAttribute("data-ignore-synth"))return;const b=u.code,T=o().keys.find(w=>w.keyCode===b),E=100,y="keyboard";if(T&&!p(T.note,y)){u.preventDefault();const w={noteNumber:T.note,velocity:E,source:y};n([...t(),w]),noteOn(w)}},$=u=>{const g=u.code,b=o().keys.find(E=>E.keyCode===g),T="keyboard";if(b&&p(b.note,T)){const E={noteNumber:b.note,velocity:0,source:T};n(y=>y.filter(w=>!(w.noteNumber===b.note&&w.source===T))),noteOff(E)}},h=()=>{const u=untrack(t);u.length>0&&(console.log("Window lost focus. Stopping UI notes:",u),u.forEach(g=>{noteOff(g)}),n([]))},S=()=>{a(u=>u-1)},A=()=>{a(u=>u+2)},O=createMemo(()=>{const u=o().keys,g=l();let b=0;const T=[];for(const E of u){let y={};E.type==="black"?y={left:`${(b-1)*g.whiteWidth+(g.whiteWidth-g.blackWidth/2)}%`}:b++,T.push({...E,style:y})}return T}),m=u=>{const g=o().keys.find(b=>b.keyCode===u);return g?t().some(b=>b.noteNumber===g.note):!1};return(()=>{var u=_tmpl$$d(),g=u.firstChild,b=g.nextSibling,T=b.nextSibling;return g.$$click=S,insert(b,createComponent(For,{get each(){return O()},children:E=>{const y=()=>m(E.keyCode);return(()=>{var w=_tmpl$2$6(),P=w.firstChild,N=P.firstChild,R=N.nextSibling;return w.addEventListener("touchcancel",C=>c(E)),w.$$touchend=c,w.$$touchendData=E,addEventListener(w,"touchstart",{passive:!1,handleEvent:C=>{d(E,C)}}),w.addEventListener("mouseleave",C=>c(E)),w.$$mouseup=c,w.$$mouseupData=E,w.$$mousedown=d,w.$$mousedownData=E,insert(N,()=>E.noteName),insert(R,()=>E.keyCode.replace("Key","").replace("Digit","")),createRenderEffect(C=>{var M=`key ${E.type}`,I=!!y(),F=E.keyCode,k=E.note,L=E.style;return M!==C.e&&className(w,C.e=M),I!==C.t&&w.classList.toggle("active",C.t=I),F!==C.a&&setAttribute(w,"data-code",C.a=F),k!==C.o&&setAttribute(w,"data-note",C.o=k),C.i=style(w,L,C.i),C},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),w})()}})),T.$$click=A,u})()};delegateEvents(["click","mousedown","mouseup","touchend"]);var _tmpl$$c=template("<div class=algorithm-matrix><table><thead><tr><th>Modulator</th><th class=out-header>OUT</th></tr></thead><tbody></tbody></table><div id=matrix-hover-info class=matrix-info-box>"),_tmpl$2$5=template("<th>"),_tmpl$3$2=template("<tr><th>"),_tmpl$4$2=template("<td><div class=connection-point>"),_tmpl$5$2=template('<td class=output-cell><div class="connection-point output-point">');const AlgorithmMatrix=e=>{const[t,n]=createSignal("Hover over a cell..."),r=()=>e.numOperators,a=f=>{const d=f.target.closest("td");d&&(e.setAlgorithmState(produce(c=>{if(d.dataset.outputOp){const _=parseInt(d.dataset.outputOp)-1,$=r();_>=0&&_<r()&&c[_]&&c[_].length>$?c[_][$]=1-(c[_][$]||0):console.warn(`AlgorithmMatrix: Invalid output access: row ${_}, col ${$}`)}else if(d.dataset.modulator&&d.dataset.modulated){const _=parseInt(d.dataset.modulator),$=parseInt(d.dataset.modulated),h=_-1,S=$-1;h>=0&&h<r()&&S>=0&&S<r()&&c[h]&&c[h].length>S?c[h][S]=1-(c[h][S]||0):console.warn(`AlgorithmMatrix: Invalid op-op access: row ${h}, col ${S}`)}})),setAlgorithm(unwrap(e.algorithm)))},o=f=>{const d=f.target.closest("td");if(!d)return;let c="Hover over a cell...";if(d.dataset.outputOp)c=`Toggle Operator ${d.dataset.outputOp} as audio output (carrier)`;else if(d.dataset.modulator&&d.dataset.modulated){const _=d.dataset.modulator,$=d.dataset.modulated;d.classList.contains("feedback-cell")?c=`Toggle Feedback for Operator ${_}`:c=`Operator ${_} modulates Operator ${$}`}n(c)},s=f=>{f.currentTarget.contains(f.relatedTarget)||n("Hover over a cell...")},l=()=>Array.from({length:r()},(f,p)=>p+1);return(()=>{var f=_tmpl$$c(),p=f.firstChild,d=p.firstChild,c=d.firstChild,_=c.firstChild,$=_.nextSibling,h=d.nextSibling,S=p.nextSibling;return f.$$mouseout=s,f.$$mouseover=o,insert(c,createComponent(For,{get each(){return l()},children:A=>(()=>{var O=_tmpl$2$5();return insert(O,A),O})()}),$),insert(h,createComponent(For,{get each(){return l()},children:A=>(()=>{var O=_tmpl$3$2(),m=O.firstChild;return insert(m,A),insert(O,createComponent(For,{get each(){return l()},children:u=>{const g=A===u,b=A-1,T=u-1,E=()=>e.algorithm[b]?.[T]===1;return(()=>{var y=_tmpl$4$2();return y.$$click=a,setAttribute(y,"data-modulator",A),setAttribute(y,"data-modulated",u),className(y,g?"feedback-cell":""),createRenderEffect(()=>y.classList.toggle("active",!!E())),y})()}}),null),insert(O,()=>{const u=A-1,g=r(),b=()=>e.algorithm[u]?.[g]===1;return(()=>{var T=_tmpl$5$2();return T.$$click=a,setAttribute(T,"data-output-op",A),createRenderEffect(()=>T.classList.toggle("active",!!b())),T})()},null),O})()})),insert(S,t),f})()};delegateEvents(["mouseover","mouseout","click"]);var _tmpl$$b=template("<div class=dial-container role=slider><div><div class=dial-indicator></div></div><input type=text class=dial-input>");const MIN_ROTATION=-135,MAX_ROTATION=135,TOTAL_ROTATION_RANGE=MAX_ROTATION-MIN_ROTATION,FINE_MODE_SENSITIVITY=.3,Dial=e=>{const[t,n]=createSignal(!1),[r,a]=createSignal(0),[o,s]=createSignal(0);let l,f;const p=m=>{const u=clampValue(m,e.minVal,e.maxVal);if(e.coarseValues&&e.coarseValues.length>0){if(!e.coarseValues||e.coarseValues.length-1<=0)return MIN_ROTATION;const g=e.coarseValues,b=e.coarseValues.length-1;let T=0;for(let N=0;N<b;N++){if(u>=g[N]&&u<=g[N+1]){T=N;break}if(N===b-1&&u===g[N+1]){T=N+1;break}}u===g[0]&&(T=0);const E=g[T],y=g[Math.min(T+1,b)];let w=0;y>E&&(w=(u-E)/(y-E));const P=T+w;return MIN_ROTATION+P/b*TOTAL_ROTATION_RANGE}else{const g=e.maxVal-e.minVal;if(g<=0)return MIN_ROTATION;const b=(u-e.minVal)/g;return MIN_ROTATION+b*TOTAL_ROTATION_RANGE}},d=m=>{const u=e.isFineModeActive(),b=(clampValue(m,MIN_ROTATION,MAX_ROTATION)-MIN_ROTATION)/TOTAL_ROTATION_RANGE;if(e.coarseValues&&e.coarseValues.length>0){if(!e.coarseValues||e.coarseValues.length-1<=0)return e.minVal;const T=e.coarseValues,E=e.coarseValues.length-1,y=b*E,w=clampValue(Math.floor(y),0,E-1),P=Math.min(E,w+1),N=y-w,R=T[w],C=T[P];let M;if(u){const I=C-R;I<=0?M=R:M=R+N*I}else{const I=clampValue(Math.round(y),0,E);M=T[I]}return clampValue(M,e.minVal,e.maxVal)}else{const T=e.maxVal-e.minVal;let E=e.minVal+b*T;return e.step&&e.step>0&&(E=Math.round(E/e.step)*e.step),clampValue(E,e.minVal,e.maxVal)}};createEffect(()=>{const m=e.value();untrack(()=>{const u=p(m);a(u)})}),createEffect(()=>{const m=t(),u=e.isFineModeActive();m?(document.body.classList.add("dial-dragging-active"),document.body.style.userSelect="none",document.body.style.cursor=u?"cell":"grabbing"):(document.body.classList.remove("dial-dragging-active"),document.body.style.userSelect="",document.body.style.cursor=u?"cell":"")});const c=(m,u)=>{if(!l)return 0;const g=l.getBoundingClientRect(),b=g.left+g.width/2,T=g.top+g.height/2;return Math.atan2(m-b,T-u)*(180/Math.PI)},_=(m,u)=>{if(!l)return;n(!0);const g=untrack(r),b=c(m,u);s(g-b),window.addEventListener("mousemove",$),window.addEventListener("mouseup",h),window.addEventListener("touchmove",$,{passive:!1}),window.addEventListener("touchend",h),window.addEventListener("touchcancel",h)},$=m=>{if(!t())return;m.preventDefault();const u=!!m.touches,g=u?m.touches[0].clientX:m.clientX,b=u?m.touches[0].clientY:m.clientY,T=c(g,b),E=untrack(r);let w=T+o()-E;for(;w<=-180;)w+=360;for(;w>180;)w-=360;const P=e.isFineModeActive()?w*FINE_MODE_SENSITIVITY:w;let N=E+P;N=clampValue(N,MIN_ROTATION,MAX_ROTATION),a(N);const R=d(N);R!==untrack(e.value)&&e.onChange(R)},h=()=>{t()&&(n(!1),window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",h),window.removeEventListener("touchmove",$),window.removeEventListener("touchend",h),window.removeEventListener("touchcancel",h),a(p(untrack(e.value))))},S=m=>{const u=m.currentTarget;let g=parseFloat(u.value);isNaN(g)?u.value=A(e.value()):(g=clampValue(g,e.minVal,e.maxVal),g!==e.value()?e.onChange(g):u.value=A(untrack(e.value)))},A=m=>{if(e.valueDisplayFormatter)return e.valueDisplayFormatter(m);const u=e.isFineModeActive()?4:3;return m.toFixed(u)},O=()=>e.isFineModeActive()?"Drag for fine detail (Release Shift for less sensitivity)":"Drag to adjust (Hold Shift for fine detail)";return(()=>{var m=_tmpl$$b(),u=m.firstChild,g=u.firstChild,b=u.nextSibling;addEventListener(u,"touchstart",{passive:!1,handleEvent:y=>{y.preventDefault(),_(y.touches[0].clientX,y.touches[0].clientY)}}),u.$$mousedown=y=>{_(y.clientX,y.clientY)};var T=l;typeof T=="function"?use(T,u):l=u,u.style.setProperty("width","70px"),u.style.setProperty("height","70px"),g.style.setProperty("width","4px"),g.style.setProperty("height","26.923076923076923px"),g.style.setProperty("border-radius","2px"),g.style.setProperty("display","block"),g.style.setProperty("overflow","hidden"),g.style.setProperty("top","0px"),g.style.setProperty("left","33px"),g.style.setProperty("transform-origin","center 35px"),b.$$keydown=y=>{y.key==="Enter"&&y.currentTarget.blur()},b.addEventListener("blur",S);var E=f;return typeof E=="function"?use(E,b):f=b,createRenderEffect(y=>{var w=e.minVal,P=e.maxVal,N=e.value(),R=e.label||"Dial Control",C=A(e.value()),M=O(),I=t()?e.isFineModeActive()?"cell":"grabbing":"grab",F=`dial ${e.isActive?.()?"active":""}`,k=`rotate(${r()}deg)`,L=e.id?`${e.id}-input`:void 0;return w!==y.e&&setAttribute(m,"aria-valuemin",y.e=w),P!==y.t&&setAttribute(m,"aria-valuemax",y.t=P),N!==y.a&&setAttribute(m,"aria-valuenow",y.a=N),R!==y.o&&setAttribute(m,"aria-label",y.o=R),C!==y.i&&setAttribute(m,"aria-valuetext",y.i=C),M!==y.n&&setAttribute(m,"title",y.n=M),I!==y.s&&((y.s=I)!=null?m.style.setProperty("cursor",I):m.style.removeProperty("cursor")),F!==y.h&&className(u,y.h=F),k!==y.r&&((y.r=k)!=null?u.style.setProperty("transform",k):u.style.removeProperty("transform")),L!==y.d&&setAttribute(b,"id",y.d=L),y},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0}),createRenderEffect(()=>b.value=A(e.value())),m})()};delegateEvents(["mousedown","keydown"]);var _tmpl$$a=template("<div><label> </label><input type=text inputmode=decimal autocomplete=off class=number-input>");const DEFAULT_MIN_DECIMAL_PLACES=0,numbersAreEqual=(e,t)=>e==null||t==null?e===t:isNaN(e)&&isNaN(t)?!0:isNaN(e)||isNaN(t)?!1:Math.abs(e-t)<1e-9,NumericParameterInput=e=>{const[t,n]=createSignal(""),[r,a]=createSignal(!1),o=()=>e.minDecimalPlaces??DEFAULT_MIN_DECIMAL_PLACES;createEffect(()=>{const d=untrack(r),c=e.numericValue()??e.default??e.min;if(!d){const _=formatNumberToMinDecimals(c,o());untrack(t)!==_&&n(_)}});const s=d=>{const _=d.currentTarget.value;if(/^-?\d*\.?\d*$/.test(_)||_===""){n(_);const h=parseFloat(_);if(!isNaN(h)){const S=clampValue(h,e.min,e.max),A=e.numericValue()??e.default??e.min;numbersAreEqual(S,A)||e.onCommit(S)}}},l=()=>{a(!0)},f=()=>{a(!1);const d=e.numericValue()??e.default??e.min,c=formatNumberToMinDecimals(d,o());n(c);const _=e.numericValue()??e.default??e.min,$=clampValue(d,e.min,e.max);numbersAreEqual($,_)||e.onCommit($)},p=d=>{if(e.disabled?.()||e.step===void 0||e.step<=0||d.target!==document.activeElement)return;d.preventDefault();const c=e.numericValue()??e.default??e.min,_=e.step;let $=0;if(d.deltaY<0)$=_;else if(d.deltaY>0)$=-_;else return;const h=String(_),S=h.includes(".")?h.split(".")[1].length:0,A=Math.pow(10,S),O=(Math.round(c*A)+Math.round($*A))/A,m=clampValue(O,e.min,e.max);if(!numbersAreEqual(m,c)&&(e.onCommit(m),r())){const u=formatNumberToMinDecimals(m,o());n(u)}};return(()=>{var d=_tmpl$$a(),c=d.firstChild,_=c.firstChild,$=c.nextSibling;return insert(c,()=>e.label,_),insert(c,()=>e.unit&&`(${e.unit})`,null),$.addEventListener("wheel",p),$.addEventListener("focus",l),$.addEventListener("blur",f),$.$$input=s,createRenderEffect(h=>{var S=`param param-${e.id} ${e.category?"param-"+e.category:""}`,A=e.style,O=e.id,m=e.id,u=e.id,g=e.disabled?e.disabled():!1;return S!==h.e&&className(d,h.e=S),h.t=style(d,A,h.t),O!==h.a&&setAttribute(c,"for",h.a=O),m!==h.o&&setAttribute($,"id",h.o=m),u!==h.i&&setAttribute($,"name",h.i=u),g!==h.n&&($.disabled=h.n=g),h},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0}),createRenderEffect(()=>$.value=t()),d})()};delegateEvents(["input"]);var _tmpl$$9=template('<div class="frequency-manager parameter-container"><label class=parameter-title>Frequency</label><div class=mode-toggle-container><input type=checkbox class=mode-toggle-checkbox aria-hidden=true tabindex=-1 readonly><label class="mode-toggle-label toggle"role=switch aria-label="Toggle frequency mode (Ratio/Fixed)"tabindex=0><span class=mode-label-text aria-hidden=true><span></span></span><div class=mode-switch-visual aria-hidden=true><div class=mode-switch-indicator></div></div></label></div><div class=dial-wrapper>');const FrequencyManager=e=>{const[t,n]=createSignal(e.fixedValue()!==0?"fixedFrequency":"ratio");createEffect(()=>{const p=e.fixedValue()!==0?"fixedFrequency":"ratio";p!==untrack(t)&&n(p)});const r=f=>{const p=untrack(t);if(f!==p)if(n(f),f==="fixedFrequency"){if(e.fixedValue()===0){const d=e.defaultFixedFrequencyOnSwitch;d===void 0&&console.warn("FrequencyManager: Switching to Fixed mode, but no defaultFixedFrequencyOnSwitch provided. Parent fixedOnChange must handle setting a default when called with 0 or current value."),e.fixedOnChange(d)}}else e.fixedValue()!==0&&e.fixedOnChange(0)},a=()=>{const p=t()==="ratio"?"fixedFrequency":"ratio";r(p)},o=()=>e.ratioMin??e.ratioCoarseValues?.[0]??0,s=()=>e.ratioMax??e.ratioCoarseValues?.[e.ratioCoarseValues.length-1]??1,l=`freq-mode-toggle-${e.id||Math.random().toString(36).substring(7)}`;return(()=>{var f=_tmpl$$9(),p=f.firstChild,d=p.nextSibling,c=d.firstChild,_=c.nextSibling,$=_.firstChild,h=$.firstChild,S=d.nextSibling;return setAttribute(c,"id",l),_.$$keydown=A=>{(A.key===" "||A.key==="Enter")&&(a(),A.preventDefault())},_.$$click=A=>{a(),A.preventDefault()},setAttribute(_,"for",l),insert(h,()=>t()==="ratio"?e.ratioLabel:e.fixedLabel),insert(S,createComponent(Show,{get when(){return t()==="ratio"},get fallback(){return createComponent(Dial,{get label(){return e.fixedLabel??"Frequency"},get id(){return e.id?`${e.id}-fixed`:void 0},get value(){return e.fixedValue},get onChange(){return e.fixedOnChange},get minVal(){return e.fixedMin},get maxVal(){return e.fixedMax},get step(){return e.fixedStep},get isFineModeActive(){return e.isFineModeActive},get isActive(){return e.isActive},get valueDisplayFormatter(){return e.formatFixedValue}})},get children(){return createComponent(Dial,{get label(){return e.ratioLabel??"Ratio"},get id(){return e.id?`${e.id}-ratio`:void 0},get value(){return e.ratioValue},get onChange(){return e.ratioOnChange},get minVal(){return o()},get maxVal(){return s()},get coarseValues(){return e.ratioCoarseValues},get isFineModeActive(){return e.isFineModeActive},get isActive(){return e.isActive},get valueDisplayFormatter(){return e.formatRatioValue}})}})),insert(f,createComponent(NumericParameterInput,{style:{"margin-top":"0.5rem",gap:"5px"},get id(){return`${e.id}-detune`},get label(){return e.detuneLabel?e.detuneLabel:"Detune:"},get numericValue(){return e.detuneValue},get onCommit(){return e.detuneOnChange},get min(){return e.detuneMin},get max(){return e.detuneMax},get default(){return e.detuneDefault},get step(){return e.detuneStep}}),null),createRenderEffect(A=>{var O=e.id,m=e.id,u=t(),g=t()==="fixedFrequency";return O!==A.e&&setAttribute(f,"id",A.e=O),m!==A.t&&setAttribute(p,"for",A.t=m),u!==A.a&&setAttribute(_,"data-mode",A.a=u),g!==A.o&&setAttribute(_,"aria-checked",A.o=g),A},{e:void 0,t:void 0,a:void 0,o:void 0}),createRenderEffect(()=>c.checked=t()==="fixedFrequency"),f})()};delegateEvents(["click","keydown"]);var _tmpl$$8=template("<div class=parameter-container> <label class=parameter-title></label><div class=crossfader-track-container><div class=crossfader-track><div class=crossfader-thumb><div class=crossfader-thumb-stripe></div></div></div></div><input type=text class=crossfader-input>");const MIN_VALUE_DEFAULT=0,MAX_VALUE_DEFAULT=10,STEP_DEFAULT=.01,FINE_MODE_DAMPING=5,FALLBACK_TRACK_HEIGHT=100,FALLBACK_TRACK_WIDTH=60,FALLBACK_THUMB_HEIGHT=30,Crossfader=e=>{const t=()=>e.minVal??MIN_VALUE_DEFAULT,n=()=>e.maxVal??MAX_VALUE_DEFAULT,r=()=>e.step??STEP_DEFAULT,a=()=>n()-t(),[o,s]=createSignal(!1),[l,f]=createSignal(0),[p,d]=createSignal(null);let c=FALLBACK_TRACK_HEIGHT,_=FALLBACK_TRACK_WIDTH,$=FALLBACK_THUMB_HEIGHT,h=Math.max(1,c-$),S,A,O;onMount(()=>{requestAnimationFrame(()=>{S?(c=S.offsetHeight,_=S.offsetWidth):console.warn("Crossfader: Could not find track container element."),A?$=A.offsetHeight:console.warn("Crossfader: Could not find thumb element."),h=Math.max(1,c-$),f(m(e.value()))})});const m=w=>{const P=a();if(P<=0||h<=0)return 0;const C=(1-(clampValue(w,t(),n())-t())/P)*h;return clampValue(C,0,h)},u=w=>{if(h<=0)return t();const N=1-clampValue(w,0,h)/h,R=a(),C=t()+N*R,M=r();let I=t()+Math.round((C-t())/M)*M;return I=clampValue(I,t(),n()),Math.abs(I-n())<M/2&&(I=n()),Math.abs(I-t())<M/2&&(I=t()),I};createEffect(()=>{const w=e.value();untrack(()=>{f(m(w))})}),createEffect(()=>{o()?(document.body.classList.add("fader-dragging-active"),document.body.style.userSelect="none",document.body.style.cursor="grabbing"):(document.body.classList.remove("fader-dragging-active"),document.body.style.userSelect="",document.body.style.cursor="")});const g=w=>{if(!S)return;s(!0);const P=S.getBoundingClientRect(),N=w-P.top;let R=clampValue(N-$/2,0,h);const C=u(R);f(m(C)),d(w),C!==e.value()&&e.onChange(C),window.addEventListener("mousemove",b),window.addEventListener("mouseup",T),window.addEventListener("touchmove",b,{passive:!1}),window.addEventListener("touchend",T),window.addEventListener("touchcancel",T)},b=w=>{if(!o()||p()===null)return;w.preventDefault();const N=!!w.touches?w.touches[0].clientY:w.clientY,R=N-p(),C=e.isFineModeActive()?R/FINE_MODE_DAMPING:R,M=clampValue(l()+C,0,h);f(M);const I=u(M);d(N),I!==untrack(e.value)&&e.onChange(I)},T=()=>{o()&&(s(!1),d(null),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",T),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",T),window.removeEventListener("touchcancel",T),f(m(e.value())))},E=w=>{const P=w.currentTarget;let N=parseFloat(P.value);const R=r();isNaN(N)?P.value=y(e.value()):(N=clampValue(N,t(),n()),N=t()+Math.round((N-t())/R)*R,N=clampValue(N,t(),n()),N!==e.value()?e.onChange(N):P.value=y(untrack(e.value)))},y=w=>{const P=String(r()),N=P.includes(".")?P.split(".")[1].length:0;return w.toFixed(Math.max(2,N))};return(()=>{var w=_tmpl$$8(),P=w.firstChild,N=P.nextSibling,R=N.nextSibling,C=R.firstChild,M=C.firstChild,I=M.firstChild,F=R.nextSibling;insert(N,()=>e.label||"Fader"),addEventListener(R,"touchstart",{passive:!1,handleEvent:D=>{D.preventDefault(),g(D.touches[0].clientY)}}),R.$$mousedown=D=>{D.button===0&&g(D.clientY)};var k=S;typeof k=="function"?use(k,R):S=R,addEventListener(M,"touchstart",{passive:!1,handleEvent:D=>{D.preventDefault(),g(D.touches[0].clientY)}}),M.$$mousedown=D=>{D.button===0&&g(D.clientY)};var L=A;typeof L=="function"?use(L,M):A=M,`${.88*_}px`!=null?I.style.setProperty("width",`${.88*_}px`):I.style.removeProperty("width"),`${$/6}px`!=null?I.style.setProperty("height",`${$/6}px`):I.style.removeProperty("height"),I.style.setProperty("position","absolute"),`${.5*$-$/12}px`!=null?I.style.setProperty("top",`${.5*$-$/12}px`):I.style.removeProperty("top"),`${.06*_}px`!=null?I.style.setProperty("left",`${.06*_}px`):I.style.removeProperty("left"),F.$$keydown=D=>{D.key==="Enter"&&(E(D),D.currentTarget.blur())},F.addEventListener("blur",E);var V=O;return typeof V=="function"?use(V,F):O=F,createRenderEffect(D=>{var q=e.id?`${e.id}-input`:void 0,B=!!o(),W=`${l()}%`,z=e.id?`${e.id}-input`:void 0;return q!==D.e&&setAttribute(N,"for",D.e=q),B!==D.t&&M.classList.toggle("dragging",D.t=B),W!==D.a&&((D.a=W)!=null?M.style.setProperty("top",W):M.style.removeProperty("top")),z!==D.o&&setAttribute(F,"id",D.o=z),D},{e:void 0,t:void 0,a:void 0,o:void 0}),createRenderEffect(()=>F.value=y(e.value())),w})()};delegateEvents(["mousedown","keydown"]);var _tmpl$$7=template("<div class=parameter-container><label class=parameter-title>Waveform</label><select>"),_tmpl$2$4=template("<option>");const WaveformSelect=e=>(()=>{var t=_tmpl$$7(),n=t.firstChild,r=n.nextSibling;return r.addEventListener("change",a=>{const s=a.currentTarget.value,l=parseInt(s,10);!isNaN(l)&&WAVEFORM_ID_TO_NAME.hasOwnProperty(l)?e.onChange(l):console.error("Invalid waveform ID selected from dropdown:",s)}),insert(r,createComponent(For,{each:WAVEFORM_NAMES,children:a=>{const o=WAVEFORM_NAME_TO_ID[a];return(()=>{var s=_tmpl$2$4();return s.value=o,insert(s,a),s})()}})),createRenderEffect(a=>{var o=`waveform-${e.operatorIndex}`,s=`waveform-${e.operatorIndex}`;return o!==a.e&&setAttribute(n,"for",a.e=o),s!==a.t&&setAttribute(r,"id",a.t=s),a},{e:void 0,t:void 0}),createRenderEffect(()=>r.value=e.value()),t})();var _tmpl$$6=template("<div class=parameter-container><label class=parameter-title>Envelope");const EnvelopeControl=e=>{const t=e.operatorIndex,n=(r,a)=>{e.onParamChange(r,a)};return(()=>{var r=_tmpl$$6();return r.firstChild,insert(r,createComponent(For,{each:envelopeParamsInfo,children:a=>{const o=`op-${t}-adsr-${a.key}`;return createComponent(NumericParameterInput,{get label(){return a.label},id:o,numericValue:()=>e.value()?.[a.key],onCommit:l=>n(a.key,l),get min(){return a.min},get max(){return a.max},get step(){return a.step},get minDecimalPlaces(){return a.minDecimals}})}}),null),r})()};var _tmpl$$5=template("<div><div class=active-filter-header><strong></strong><button class=remove-filter-button>✕</button></div><div class=active-filter-params>"),_tmpl$2$3=template("<span>No params.");const ActiveFilterDisplay=e=>{const t=()=>FILTERS.find(a=>a.type===e.filterState.type),n=()=>{e.onRemove(e.filterState.type)},r=(a,o)=>{e.onParamCommit(e.filterIndex,a,o)};return(()=>{var a=_tmpl$$5(),o=a.firstChild,s=o.firstChild,l=s.nextSibling,f=o.nextSibling;return insert(s,()=>t()?.name??"Unknown Filter"),l.$$click=n,insert(f,createComponent(For,{get each(){return t()?.params},get fallback(){return _tmpl$2$3()},children:p=>createComponent(NumericParameterInput,{get label(){return p.name},get id(){return`op-${e.operatorIndex}-active-${e.filterState.type}-${p.id}`},numericValue:()=>{let c;switch(e.filterState.type){case"LowPass":c=e.filterState.params[p.id];break;case"Comb":c=e.filterState.params[p.id];break;case"PitchedComb":c=e.filterState.params[p.id];break}return c??p.default},onCommit:c=>r(p.id,c),get min(){return p.min},get max(){return p.max},get step(){return p.step},get unit(){return p.unit}})})),createRenderEffect(p=>{var d=`active-filter-control filter-type-${t()?.value??"unknown"}`,c=`Remove ${t()?.name??"Filter"}`;return d!==p.e&&className(a,p.e=d),c!==p.t&&setAttribute(l,"title",p.t=c),p},{e:void 0,t:void 0}),a})()};delegateEvents(["click"]);var _tmpl$$4=template("<div class=parameter-container><label class=parameter-title>Add Filter</label><select class=filter-type-select-adder><option value>Select Filter..."),_tmpl$2$2=template('<button class="add-filter-button button">Add Filter to Chain'),_tmpl$3$1=template("<div class=parameter-container>"),_tmpl$4$1=template("<div class=parameter-container><label class=parameter-title>Active Filters</label><div class=active-filters-display>"),_tmpl$5$1=template("<option>"),_tmpl$6$1=template("<i> has no adjustable parameters.");const FilterManager=e=>{const t=e.operatorIndex,[n,r]=createSignal(null),[a,o]=createSignal({}),s=createMemo(()=>appStore.operators[t]?.filters??[]),l=createMemo(()=>new Set(s().map(h=>h.type))),f=createMemo(()=>{const h=n();return h?FILTERS.find(S=>S.type===h):null}),p=h=>{const A=h.currentTarget.value||null;r(A);const O=A?FILTERS.find(u=>u.type===A):null,m={};O?.params?.forEach(u=>{m[u.id]=u.default}),o(m)},d=(h,S)=>{o(A=>({...A,[h]:S}))},c=async()=>{const h=n(),S=f();if(!h||!S){alert("Please select a filter type.");return}if(l().has(h)){alert(`${S.name} is already in the filter chain.`);return}const A={...a()},O={};S.params.forEach(g=>{O[g.id]=A[g.id]??g.default});let m;switch(h){case"LowPass":m={type:"LowPass",params:O};break;case"Comb":m={type:"Comb",params:O};break;case"PitchedComb":m={type:"PitchedComb",params:O};break;default:console.error(`Unknown filter typeTag: ${h}`);return}setOperatorFilter(t,objToJsonBytes(m)),setAppStore("operators",t,"filters",(g=[])=>[...g,m]),r(null),o({});const u=document.getElementById(`op-${t}-filter-type-select-adder`);u&&(u.value="")},_=async(h,S,A)=>{const O=s()[h];if(!O)return;const m={...O.params,[S]:A},u={type:O.type,params:m};setOperatorFilter(t,objToJsonBytes(u));let g;switch(O.type){case"LowPass":g=m;break;case"Comb":g=m;break;case"PitchedComb":g=m;break;default:console.error("Unknown typeTag");return}setAppStore("operators",t,"filters",h,"params",g)},$=async h=>{removeOperatorFilter(t,stringToBytes(h)),setAppStore("operators",t,"filters",(S=[])=>S.filter(A=>A.type!==h))};return[(()=>{var h=_tmpl$$4(),S=h.firstChild,A=S.nextSibling;return A.firstChild,A.addEventListener("change",p),setAttribute(A,"id",`op-${t}-filter-type-select-adder`),insert(A,createComponent(For,{each:FILTERS,children:O=>(()=>{var m=_tmpl$5$1();return insert(m,()=>O.name),createRenderEffect(()=>m.disabled=l().has(O.type)),createRenderEffect(()=>m.value=O.type),m})()}),null),createRenderEffect(()=>A.value=n()??""),h})(),(()=>{var h=_tmpl$3$1();return insert(h,createComponent(Show,{get when(){return f()?.params?.length>0},get fallback(){return createComponent(Show,{get when(){return n()!==null},get children(){return[" ",(()=>{var S=_tmpl$6$1(),A=S.firstChild;return insert(S,()=>f()?.name??"",A),S})()," "]}})},get children(){return[createComponent(For,{get each(){return f()?.params},children:S=>createComponent(NumericParameterInput,{get label(){return S.name},get id(){return`op-${t}-adder-${f()?.type}-${S.id}`},numericValue:()=>a()[S.id]??S.default,onCommit:O=>d(S.id,O),get min(){return S.min},get max(){return S.max},get step(){return S.step},get unit(){return S.unit}})}),(()=>{var S=_tmpl$2$2();return S.$$click=c,setAttribute(S,"id",`op-${t}-add-filter-button`),createRenderEffect(()=>S.disabled=!n()),S})()]}})),h})(),createComponent(Show,{get when(){return s()?.length>0},get children(){var h=_tmpl$4$1(),S=h.firstChild,A=S.nextSibling;return insert(A,createComponent(For,{get each(){return s()},fallback:"No filters active.",children:(O,m)=>createComponent(ActiveFilterDisplay,{operatorIndex:t,filterState:O,get filterIndex(){return m()},onParamCommit:_,onRemove:$})})),h}})]};delegateEvents(["click"]);var _tmpl$$3=template("<div class=operator-control><h3>Operator </h3><hr><hr><hr><hr>");const RATIO_COARSE_STRINGS=["1/128","1/64","1/32","1/16","1/8","1/4","1/2",...Array.from({length:32},(e,t)=>(t+1).toString())],RATIO_COARSE_VALUES=RATIO_COARSE_STRINGS.map(v=>{try{return eval(v)}catch{return 1}}),RATIO_MIN=RATIO_COARSE_VALUES[0],RATIO_MAX=RATIO_COARSE_VALUES[RATIO_COARSE_VALUES.length-1],FIXED_FREQ_MIN=1e-4,FIXED_FREQ_MAX=2e4,DEFAULT_FIXED_FREQ_ON_SWITCH=440,MOD_INDEX_MIN=0,MOD_INDEX_MAX=10,MOD_INDEX_STEP=.01,OperatorControl=e=>{const t=()=>appStore.operators[e.operatorIndex]?.ratio,n=()=>appStore.operators[e.operatorIndex]?.fixedFrequency,r=()=>appStore.operators[e.operatorIndex]?.detune,a=()=>appStore.operators[e.operatorIndex]?.modulationIndex,o=()=>appStore.operators[e.operatorIndex]?.waveform,s=()=>appStore.operators[e.operatorIndex]?.envelope,l=h=>{setOperatorRatio(e.operatorIndex,h),setAppStore("operators",e.operatorIndex,"ratio",h),n()!==0&&(setAppStore("operators",e.operatorIndex,"fixedFrequency",0),setOperatorFixedFrequency(e.operatorIndex,0))},f=h=>{if(setOperatorFixedFrequency(e.operatorIndex,h),h===0){const S=appStore.operators[e.operatorIndex]?.ratio;S!==void 0?setOperatorRatio(e.operatorIndex,S):setOperatorRatio(e.operatorIndex,1)}setAppStore("operators",e.operatorIndex,"fixedFrequency",h)},p=h=>{setOperatorDetune(e.operatorIndex,h),setAppStore("operators",e.operatorIndex,"detune",h)},d=h=>{setOperatorModIndex(e.operatorIndex,h),setAppStore("operators",e.operatorIndex,"modulationIndex",h)},c=h=>{setOperatorWaveform(e.operatorIndex,h),setAppStore("operators",e.operatorIndex,"waveform",h)},_=(h,S)=>{if(typeof S=="number"&&S>=0){setAppStore("operators",e.operatorIndex,"envelope",h,S);let A=s().attack,O=s().decay,m=s().sustain,u=s().release;setOperatorEnvelope(e.operatorIndex,A,O,m,u)}else console.error(`OperatorControl received invalid value for ${h}: ${S}`)},$=()=>appStore.algorithm[e.operatorIndex]?.[NUM_OPERATORS]===1;return(()=>{var h=_tmpl$$3(),S=h.firstChild;S.firstChild;var A=S.nextSibling,O=A.nextSibling,m=O.nextSibling,u=m.nextSibling;return insert(S,()=>e.operatorIndex+1,null),insert(h,createComponent(FrequencyManager,{ratioLabel:"Ratio",ratioMin:RATIO_MIN,ratioMax:RATIO_MAX,ratioCoarseValues:RATIO_COARSE_VALUES,ratioValue:t,ratioOnChange:l,fixedLabel:"Fixed",fixedMin:FIXED_FREQ_MIN,fixedMax:FIXED_FREQ_MAX,fixedValue:n,fixedOnChange:f,defaultFixedFrequencyOnSwitch:DEFAULT_FIXED_FREQ_ON_SWITCH,detuneLabel:"Detune:",detuneValue:r,detuneOnChange:p,detuneMin:-1200,detuneMax:1200,detuneDefault:0,detuneStep:.5,get id(){return"freq-manager-"+e.operatorIndex},isActive:$,get isFineModeActive(){return e.isFineModeActive}}),A),A.style.setProperty("border-top","1px solid red;"),A.style.setProperty("width","100%"),insert(h,createComponent(Crossfader,{label:"Mod Index",get id(){return"mod-"+e.operatorIndex},value:a,onChange:d,get isFineModeActive(){return e.isFineModeActive},minVal:MOD_INDEX_MIN,maxVal:MOD_INDEX_MAX,step:MOD_INDEX_STEP}),O),insert(h,createComponent(WaveformSelect,{value:o,onChange:c,get operatorIndex(){return e.operatorIndex}}),m),insert(h,createComponent(EnvelopeControl,{get operatorIndex(){return e.operatorIndex},value:s,onParamChange:_}),u),insert(h,createComponent(FilterManager,{get operatorIndex(){return e.operatorIndex}}),null),h})()};var u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(e,t){for(var n=new u16(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new i32(n[30]),r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)a[o]=o-n[r]<<5|r;return{b:n,r:a}},_a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b.b,revfd=_b.r,rev=new u16(32768);for(var i=0;i<32768;++i){var x=(i&43690)>>1|(i&21845)<<1;x=(x&52428)>>2|(x&13107)<<2,x=(x&61680)>>4|(x&3855)<<4,rev[i]=((x&65280)>>8|(x&255)<<8)>>1}var hMap=function(e,t,n){for(var r=e.length,a=0,o=new u16(t);a<r;++a)e[a]&&++o[e[a]-1];var s=new u16(t);for(a=1;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;var l;if(n){l=new u16(1<<t);var f=15-t;for(a=0;a<r;++a)if(e[a])for(var p=a<<4|e[a],d=t-e[a],c=s[e[a]-1]++<<d,_=c|(1<<d)-1;c<=_;++c)l[rev[c]>>f]=p}else for(l=new u16(r),a=0;a<r;++a)e[a]&&(l[a]=rev[s[e[a]-1]++]>>15-e[a]);return l},flt=new u8(288);for(var i=0;i<144;++i)flt[i]=8;for(var i=144;i<256;++i)flt[i]=9;for(var i=256;i<280;++i)flt[i]=7;for(var i=280;i<288;++i)flt[i]=8;var fdt=new u8(32);for(var i=0;i<32;++i)fdt[i]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},bits=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(t&7)&n},bits16=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},shft=function(e){return(e+7)/8|0},slc=function(e,t,n){return(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length),new u8(e.subarray(t,n))},ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(e,t,n){var r=new Error(t||ec[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,err),!n)throw r;return r},inflt=function(e,t,n,r){var a=e.length,o=0;if(!a||t.f&&!t.l)return n||new u8(0);var s=!n,l=s||t.i!=2,f=t.i;s&&(n=new u8(a*3));var p=function(K){var X=n.length;if(K>X){var Y=new u8(Math.max(X*2,K));Y.set(n),n=Y}},d=t.f||0,c=t.p||0,_=t.b||0,$=t.l,h=t.d,S=t.m,A=t.n,O=a*8;do{if(!$){d=bits(e,c,1);var m=bits(e,c+1,3);if(c+=3,m)if(m==1)$=flrm,h=fdrm,S=9,A=5;else if(m==2){var T=bits(e,c,31)+257,E=bits(e,c+10,15)+4,y=T+bits(e,c+5,31)+1;c+=14;for(var w=new u8(y),P=new u8(19),N=0;N<E;++N)P[clim[N]]=bits(e,c+N*3,7);c+=E*3;for(var R=max(P),C=(1<<R)-1,M=hMap(P,R,1),N=0;N<y;){var I=M[bits(e,c,C)];c+=I&15;var u=I>>4;if(u<16)w[N++]=u;else{var F=0,k=0;for(u==16?(k=3+bits(e,c,3),c+=2,F=w[N-1]):u==17?(k=3+bits(e,c,7),c+=3):u==18&&(k=11+bits(e,c,127),c+=7);k--;)w[N++]=F}}var L=w.subarray(0,T),V=w.subarray(T);S=max(L),A=max(V),$=hMap(L,S,1),h=hMap(V,A,1)}else err(1);else{var u=shft(c)+4,g=e[u-4]|e[u-3]<<8,b=u+g;if(b>a){f&&err(0);break}l&&p(_+g),n.set(e.subarray(u,b),_),t.b=_+=g,t.p=c=b*8,t.f=d;continue}if(c>O){f&&err(0);break}}l&&p(_+131072);for(var D=(1<<S)-1,q=(1<<A)-1,B=c;;B=c){var F=$[bits16(e,c)&D],W=F>>4;if(c+=F&15,c>O){f&&err(0);break}if(F||err(2),W<256)n[_++]=W;else if(W==256){B=c,$=null;break}else{var z=W-254;if(W>264){var N=W-257,H=fleb[N];z=bits(e,c,(1<<H)-1)+fl[N],c+=H}var j=h[bits16(e,c)&q],U=j>>4;j||err(3),c+=j&15;var V=fd[U];if(U>3){var H=fdeb[U];V+=bits16(e,c)&(1<<H)-1,c+=H}if(c>O){f&&err(0);break}l&&p(_+131072);var J=_+z;if(_<V){var Q=o-V,G=Math.min(V,J);for(Q+_<0&&err(3);_<G;++_)n[_]=r[Q+_]}for(;_<J;++_)n[_]=n[_-V]}}t.l=$,t.p=B,t.b=_,t.f=d,$&&(d=1,t.m=S,t.d=h,t.n=A)}while(!d);return _!=n.length&&s?slc(n,0,_):n.subarray(0,_)},wbits=function(e,t,n){n<<=t&7;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8},wbits16=function(e,t,n){n<<=t&7;var r=t/8|0;e[r]|=n,e[r+1]|=n>>8,e[r+2]|=n>>16},hTree=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var a=n.length,o=n.slice();if(!a)return{t:et,l:0};if(a==1){var s=new u8(n[0].s+1);return s[n[0].s]=1,{t:s,l:1}}n.sort(function(b,T){return b.f-T.f}),n.push({s:-1,f:25001});var l=n[0],f=n[1],p=0,d=1,c=2;for(n[0]={s:-1,f:l.f+f.f,l,r:f};d!=a-1;)l=n[n[p].f<n[c].f?p++:c++],f=n[p!=d&&n[p].f<n[c].f?p++:c++],n[d++]={s:-1,f:l.f+f.f,l,r:f};for(var _=o[0].s,r=1;r<a;++r)o[r].s>_&&(_=o[r].s);var $=new u16(_+1),h=ln(n[d-1],$,0);if(h>t){var r=0,S=0,A=h-t,O=1<<A;for(o.sort(function(T,E){return $[E.s]-$[T.s]||T.f-E.f});r<a;++r){var m=o[r].s;if($[m]>t)S+=O-(1<<h-$[m]),$[m]=t;else break}for(S>>=A;S>0;){var u=o[r].s;$[u]<t?S-=1<<t-$[u]++-1:++r}for(;r>=0&&S;--r){var g=o[r].s;$[g]==t&&(--$[g],++S)}h=t}return{t:new u8($),l:h}},ln=function(e,t,n){return e.s==-1?Math.max(ln(e.l,t,n+1),ln(e.r,t,n+1)):t[e.s]=n},lc=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new u16(++t),r=0,a=e[0],o=1,s=function(f){n[r++]=f},l=1;l<=t;++l)if(e[l]==a&&l!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)s(32754);o>2&&(s(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(s(a),--o;o>6;o-=6)s(8304);o>2&&(s(o-3<<5|8208),o=0)}for(;o--;)s(a);o=1,a=e[l]}return{c:n.subarray(0,r),n:t}},clen=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},wfblk=function(e,t,n){var r=n.length,a=shft(t+2);e[a]=r&255,e[a+1]=r>>8,e[a+2]=e[a]^255,e[a+3]=e[a+1]^255;for(var o=0;o<r;++o)e[a+o+4]=n[o];return(a+4+r)*8},wblk=function(e,t,n,r,a,o,s,l,f,p,d){wbits(t,d++,n),++a[256];for(var c=hTree(a,15),_=c.t,$=c.l,h=hTree(o,15),S=h.t,A=h.l,O=lc(_),m=O.c,u=O.n,g=lc(S),b=g.c,T=g.n,E=new u16(19),y=0;y<m.length;++y)++E[m[y]&31];for(var y=0;y<b.length;++y)++E[b[y]&31];for(var w=hTree(E,7),P=w.t,N=w.l,R=19;R>4&&!P[clim[R-1]];--R);var C=p+5<<3,M=clen(a,flt)+clen(o,fdt)+s,I=clen(a,_)+clen(o,S)+s+14+3*R+clen(E,P)+2*E[16]+3*E[17]+7*E[18];if(f>=0&&C<=M&&C<=I)return wfblk(t,d,e.subarray(f,f+p));var F,k,L,V;if(wbits(t,d,1+(I<M)),d+=2,I<M){F=hMap(_,$,0),k=_,L=hMap(S,A,0),V=S;var D=hMap(P,N,0);wbits(t,d,u-257),wbits(t,d+5,T-1),wbits(t,d+10,R-4),d+=14;for(var y=0;y<R;++y)wbits(t,d+3*y,P[clim[y]]);d+=3*R;for(var q=[m,b],B=0;B<2;++B)for(var W=q[B],y=0;y<W.length;++y){var z=W[y]&31;wbits(t,d,D[z]),d+=P[z],z>15&&(wbits(t,d,W[y]>>5&127),d+=W[y]>>12)}}else F=flm,k=flt,L=fdm,V=fdt;for(var y=0;y<l;++y){var H=r[y];if(H>255){var z=H>>18&31;wbits16(t,d,F[z+257]),d+=k[z+257],z>7&&(wbits(t,d,H>>23&31),d+=fleb[z]);var j=H&31;wbits16(t,d,L[j]),d+=V[j],j>3&&(wbits16(t,d,H>>5&8191),d+=fdeb[j])}else wbits16(t,d,F[H]),d+=k[H]}return wbits16(t,d,F[256]),d+k[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et=new u8(0),dflt=function(e,t,n,r,a,o){var s=o.z||e.length,l=new u8(r+s+5*(1+Math.ceil(s/7e3))+a),f=l.subarray(r,l.length-a),p=o.l,d=(o.r||0)&7;if(t){d&&(f[0]=o.r>>3);for(var c=deo[t-1],_=c>>13,$=c&8191,h=(1<<n)-1,S=o.p||new u16(32768),A=o.h||new u16(h+1),O=Math.ceil(n/3),m=2*O,u=function(Z){return(e[Z]^e[Z+1]<<O^e[Z+2]<<m)&h},g=new i32(25e3),b=new u16(288),T=new u16(32),E=0,y=0,w=o.i||0,P=0,N=o.w||0,R=0;w+2<s;++w){var C=u(w),M=w&32767,I=A[C];if(S[M]=I,A[C]=M,N<=w){var F=s-w;if((E>7e3||P>24576)&&(F>423||!p)){d=wblk(e,f,0,g,b,T,y,P,R,w-R,d),P=E=y=0,R=w;for(var k=0;k<286;++k)b[k]=0;for(var k=0;k<30;++k)T[k]=0}var L=2,V=0,D=$,q=M-I&32767;if(F>2&&C==u(w-q))for(var B=Math.min(_,F)-1,W=Math.min(32767,w),z=Math.min(258,F);q<=W&&--D&&M!=I;){if(e[w+L]==e[w+L-q]){for(var H=0;H<z&&e[w+H]==e[w+H-q];++H);if(H>L){if(L=H,V=q,H>B)break;for(var j=Math.min(q,H-2),U=0,k=0;k<j;++k){var J=w-q+k&32767,Q=S[J],G=J-Q&32767;G>U&&(U=G,I=J)}}}M=I,I=S[M],q+=M-I&32767}if(V){g[P++]=268435456|revfl[L]<<18|revfd[V];var K=revfl[L]&31,X=revfd[V]&31;y+=fleb[K]+fdeb[X],++b[257+K],++T[X],N=w+L,++E}else g[P++]=e[w],++b[e[w]]}}for(w=Math.max(w,N);w<s;++w)g[P++]=e[w],++b[e[w]];d=wblk(e,f,p,g,b,T,y,P,R,w-R,d),p||(o.r=d&7|f[d/8|0]<<3,d-=7,o.h=A,o.p=S,o.i=w,o.w=N)}else{for(var w=o.w||0;w<s+p;w+=65535){var Y=w+65535;Y>=s&&(f[d/8|0]=p,Y=s),d=wfblk(f,d+1,e.subarray(w,Y))}o.i=s}return slc(l,0,r+shft(d)+a)},dopt=function(e,t,n,r,a){if(!a&&(a={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),s=new u8(o.length+e.length);s.set(o),s.set(e,o.length),e=s,a.w=o.length}return dflt(e,t.level==null?6:t.level,t.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,n,r,a)};function deflateSync(e,t){return dopt(e,{},0,0)}function inflateSync(e,t){return inflt(e,{i:2},t,t)}var te=typeof TextEncoder<"u"&&new TextEncoder,td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(e){}var dutf8=function(e){for(var t="",n=0;;){var r=e[n++],a=(r>127)+(r>223)+(r>239);if(n+a>e.length)return{s:t,r:slc(e,n-1)};a?a==3?(r=((r&15)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,t+=String.fromCharCode(55296|r>>10,56320|r&1023)):a&1?t+=String.fromCharCode((r&31)<<6|e[n++]&63):t+=String.fromCharCode((r&15)<<12|(e[n++]&63)<<6|e[n++]&63):t+=String.fromCharCode(r)}};function strToU8(e,t){var n;if(te)return te.encode(e);for(var r=e.length,a=new u8(e.length+(e.length>>1)),o=0,s=function(p){a[o++]=p},n=0;n<r;++n){if(o+5>a.length){var l=new u8(o+8+(r-n<<1));l.set(a),a=l}var f=e.charCodeAt(n);f<128||t?s(f):f<2048?(s(192|f>>6),s(128|f&63)):f>55295&&f<57344?(f=65536+(f&1047552)|e.charCodeAt(++n)&1023,s(240|f>>18),s(128|f>>12&63),s(128|f>>6&63),s(128|f&63)):(s(224|f>>12),s(128|f>>6&63),s(128|f&63))}return slc(a,0,o)}function strFromU8(e,t){var n;if(td)return td.decode(e);var r=dutf8(e),a=r.s,n=r.r;return n.length&&err(8),a}const serializeState=e=>{try{const t=JSON.stringify(unwrap(e)),n=strToU8(t),r=deflateSync(n),a=u8ArrayToBinaryString(r),o=btoa(a);return encodeURIComponent(o)}catch(t){return console.error("URL State: Failed to serialize and compress state:",t),""}},deserializeState=e=>{if(!e||e.length<=1)return null;console.log(e);let t=null;try{const n=decodeURIComponent(e),r=atob(n),a=binaryStringToU8Array(r);try{const o=inflateSync(a);t=strFromU8(o),console.log("URL State: Successfully decompressed state from hash.")}catch(o){console.warn("URL State: Failed to decompress hash data, attempting to parse as raw JSON string.",o),t=r}if(t){const o=JSON.parse(t);return typeof o=="object"&&o!==null&&"operators"in o&&"algorithm"in o&&Array.isArray(o.operators)?(console.log("URL State: Parsed state from hash looks valid."),o):(console.warn("URL State: Parsed state from URL hash does not match expected AppState structure.",o),null)}else return console.warn("URL State: Could not obtain a potential JSON string after decoding/decompression attempt."),null}catch(n){return console.error("URL State: Failed to deserialize state from URL hash:",n,"Hash was:",e),null}};var _tmpl$$2=template('<div class=save-as-new-form><input type=text placeholder="Enter new patch name"data-ignore-synth=true><button>Confirm</button><button>Cancel'),_tmpl$2$1=template("<li>Loading default patches..."),_tmpl$3=template("<li class=error>Error loading default patches."),_tmpl$4=template("<li>No patches found."),_tmpl$5=template("<div class=patch-manager><h3>Patch Manager</h3><div class=patch-actions><button>Save Current</button><button>Save As New...</button><button>Reset Synth</button></div><div class=patch-list-container><ul class=patch-list></ul></div><div class=patch-actions><input type=file id=file-input accept=.json><label for=file-input class=button>Import...</label><button>Export...</button><button>"),_tmpl$6=template("<li class=patch-section-header>"),_tmpl$7=template("<span class=patch-name>"),_tmpl$8=template('<div class=patch-item-actions><button class=edit-btn title="Rename patch"><svg xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 24 24"stroke-width=1.5 stroke=currentColor class=size-6><path stroke-linecap=round stroke-linejoin=round d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></button><button class=delete-btn title="Delete patch"><svg xmlns=http://www.w3.org/2000/svg fill=none viewBox="0 0 24 24"stroke-width=1.5 stroke=currentColor class=size-6><path stroke-linecap=round stroke-linejoin=round d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0">'),_tmpl$9=template("<li class=patch-item>"),_tmpl$10=template("<div class=edit-name-container><input type=text data-ignore-synth=true>");const USER_PATCHES_STORAGE_KEY="userSynthPatches_v1",loadUserPatches=()=>{try{const e=localStorage.getItem(USER_PATCHES_STORAGE_KEY);if(e)return JSON.parse(e).map(n=>({...n,type:"user",id:`user-${n.name}`}))}catch(e){console.error("Error loading user patches from localStorage:",e),localStorage.removeItem(USER_PATCHES_STORAGE_KEY)}return[]},saveUserPatches=e=>{try{const t=e.map(({name:n,state:r,section:a})=>({name:n,state:r,section:a}));localStorage.setItem(USER_PATCHES_STORAGE_KEY,JSON.stringify(t))}catch(t){console.error("Error saving user patches to localStorage:",t),alert("Failed to save user patches. LocalStorage might be full or disabled.")}},exportPatch=()=>{const e=document.createElement("a");e.href=URL.createObjectURL(new Blob([JSON.stringify(appStore,null,2)],{type:"text/plain"})),e.setAttribute("download","rustfmsynth_patch.json"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},PatchManager=()=>{const[e,t]=createSignal(null),[n,r]=createSignal([]),[a,o]=createSignal(!1),[s,l]=createSignal(""),[f,p]=createSignal(null),[d,c]=createSignal(""),[_,$]=createSignal(!1),[h]=createResource("./default-patches.json",async C=>{try{const M=await fetch(C);if(!M.ok)throw new Error(`HTTP error! status: ${M.status}`);return(await M.json()).map(F=>({...F,type:"default",id:`default-${F.section||"misc"}-${F.name}`}))}catch(M){return console.error("Error fetching default patches:",M),alert("Could not load default patches."),[]}});onMount(()=>{r(loadUserPatches())});const S=createMemo(()=>{const C=h()??[],M=n(),I=[],F={};return C.forEach(k=>{const L=k.section||"Uncategorized Defaults";F[L]||(F[L]=[]),F[L].push(k)}),Object.entries(F).sort(([k],[L])=>k.localeCompare(L)).forEach(([k,L])=>{I.push({isSection:!0,name:k}),L.sort((V,D)=>V.name.localeCompare(D.name)).forEach(V=>I.push({isSection:!1,patch:V}))}),M.length>0&&(I.push({isSection:!0,name:"User Patches"}),M.sort((k,L)=>k.name.localeCompare(L.name)).forEach(k=>I.push({isSection:!1,patch:k}))),I}),A=createMemo(()=>{const C=e();if(!C)return null;const I=S().find(F=>!F.isSection&&F.patch.id===C);return I&&!I.isSection?I.patch:null}),O=createMemo(()=>{const C=A();return C!==null&&C.type==="user"}),m=C=>{batch(()=>{const M=fillMissingAppState(unwrap(C.state));setAppStore(M),t(C.id),o(!1),p(null),setSynthState(unwrap(M))})},u=()=>{const C=A();if(!C||C.type!=="user"){console.warn("Save current called on non-user patch or no selection.");return}const M=n().map(I=>I.id===C.id?{...I,state:JSON.parse(JSON.stringify(appStore))}:I);batch(()=>{r(M),saveUserPatches(M)}),alert(`Patch '${C.name}' saved.`)},g=()=>{const C=s().trim();if(!C){alert("Please enter a name for the new patch.");return}const M=C.toLowerCase();if(n().some(k=>k.name.toLowerCase()===M)||(h()??[]).some(k=>k.name.toLowerCase()===M)){alert(`A patch named "${C}" already exists. Please choose a different name.`);return}const I={name:C,state:JSON.parse(JSON.stringify(appStore)),type:"user",id:`user-${C}`},F=[...n(),I];batch(()=>{r(F),saveUserPatches(F),l(""),o(!1),t(I.id)}),alert(`Patch '${C}' saved.`)},b=(C,M)=>{if(M.stopPropagation(),C.type==="user"&&confirm(`Are you sure you want to delete the user patch "${C.name}"?`)){const I=n().filter(F=>F.id!==C.id);batch(()=>{r(I),saveUserPatches(I),e()===C.id&&t(null)})}},T=(C,M)=>{M.stopPropagation(),C.type==="user"&&(batch(()=>{p(C.id),c(C.name),t(C.id)}),setTimeout(()=>{document.getElementById(`edit-patch-name-${C.id}`)?.focus()},0))},E=(C,M)=>{M?.stopPropagation();const I=d().trim();if(!I){alert("Patch name cannot be empty."),c(C.name);return}if(I===C.name){p(null);return}const F=I.toLowerCase();if(n().some(V=>V.id!==C.id&&V.name.toLowerCase()===F)||(h()??[]).some(V=>V.name.toLowerCase()===F)){alert(`A patch named "${I}" already exists. Please choose a different name.`);return}const L=n().map(V=>V.id===C.id?{...V,name:I,id:`user-${I}`}:V);batch(()=>{r(L),saveUserPatches(L),t(`user-${I}`),p(null)})},y=C=>{C?.stopPropagation(),p(null),c("")},w=(C,M)=>{M.key==="Enter"?E(C,M):M.key==="Escape"&&y(M)},P=()=>{const C=createDefaultAppState();setAppStore(unwrap(C)),t(null),setSynthState(unwrap(C)),alert("Synth reset to initial default state.")},N=C=>{const I=C.target.files?.[0];if(!I)return;const F=new FileReader;F.onload=k=>{try{const L=k.target?.result;if(typeof L=="string"){const V=JSON.parse(L);setAppStore(V),t(null),setSynthState(unwrap(V))}else console.error("Unexpected file reader result type")}catch(L){console.error("Invalid JSON",L)}},F.readAsText(I)},R=async()=>{try{const C=serializeState(appStore),M=`${window.location.origin}${window.location.pathname}#${C}`;await navigator.clipboard.writeText(M),$(!0),setTimeout(()=>$(!1),2e3),console.log("Share URL copied!")}catch(C){console.error("Failed to copy share URL",C)}};return(()=>{var C=_tmpl$5(),M=C.firstChild,I=M.nextSibling,F=I.firstChild,k=F.nextSibling,L=k.nextSibling,V=I.nextSibling,D=V.firstChild,q=V.nextSibling,B=q.firstChild,W=B.nextSibling,z=W.nextSibling,H=z.nextSibling;return F.$$click=u,k.$$click=()=>batch(()=>{o(!0),p(null)}),L.$$click=P,insert(C,createComponent(Show,{get when(){return a()},get children(){var j=_tmpl$$2(),U=j.firstChild,J=U.nextSibling,Q=J.nextSibling;return U.$$keydown=G=>G.key==="Enter"&&g(),U.$$input=G=>l(G.currentTarget.value),J.$$click=g,Q.$$click=()=>o(!1),createRenderEffect(()=>U.value=s()),j}}),V),insert(D,createComponent(Show,{get when(){return h.loading},get children(){return _tmpl$2$1()}}),null),insert(D,createComponent(Show,{get when(){return h.error},get children(){return _tmpl$3()}}),null),insert(D,createComponent(For,{get each(){return S()},children:j=>createComponent(Show,{get when(){return j.isSection},get fallback(){const U=j.patch,J=()=>e()===U.id,Q=()=>f()===U.id;return(()=>{var G=_tmpl$9();return G.$$click=()=>!Q()&&m(U),insert(G,createComponent(Show,{get when(){return!Q()},get fallback(){return(()=>{var K=_tmpl$10(),X=K.firstChild;return X.addEventListener("blur",()=>E(U)),X.$$click=Y=>Y.stopPropagation(),X.$$keydown=Y=>w(U,Y),X.$$input=Y=>c(Y.currentTarget.value),createRenderEffect(()=>setAttribute(X,"id",`edit-patch-name-${U.id}`)),createRenderEffect(()=>X.value=d()),K})()},get children(){return[" ",(()=>{var K=_tmpl$7();return insert(K,()=>U.name),K})(),createComponent(Show,{get when(){return U.type==="user"},get children(){var K=_tmpl$8(),X=K.firstChild,Y=X.nextSibling;return X.$$click=Z=>T(U,Z),X.style.setProperty("width","1em"),Y.$$click=Z=>b(U,Z),Y.style.setProperty("width","1em"),K}})]}})),createRenderEffect(K=>{var X=U.type==="default",Y=U.type==="user",Z=!!(J()&&!Q()),ee=!!Q(),ne=U.type==="default"?"Default Patch":"User Patch";return X!==K.e&&G.classList.toggle("patch-default",K.e=X),Y!==K.t&&G.classList.toggle("patch-user",K.t=Y),Z!==K.a&&G.classList.toggle("selected",K.a=Z),ee!==K.o&&G.classList.toggle("editing",K.o=ee),ne!==K.i&&setAttribute(G,"title",K.i=ne),K},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),G})()},get children(){var U=_tmpl$6();return insert(U,()=>j.name),U}})}),null),insert(D,createComponent(Show,{get when(){return createMemo(()=>!h.loading)()&&S().length===0},get children(){return _tmpl$4()}}),null),B.addEventListener("change",N),B.style.setProperty("display","none"),z.$$click=exportPatch,H.$$click=R,insert(H,()=>_()?"Copied!":"Share URL"),createRenderEffect(()=>F.disabled=!O()),C})()};delegateEvents(["click","input","keydown"]);function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var fft,hasRequiredFft;function requireFft(){if(hasRequiredFft)return fft;hasRequiredFft=1;function e(t){if(this.size=t|0,this.size<=1||(this.size&this.size-1)!==0)throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var n=new Array(this.size*2),r=0;r<n.length;r+=2){const p=Math.PI*r/this.size;n[r]=Math.cos(p),n[r+1]=-Math.sin(p)}this.table=n;for(var a=0,o=1;this.size>o;o<<=1)a++;this._width=a%2===0?a-1:a,this._bitrev=new Array(1<<this._width);for(var s=0;s<this._bitrev.length;s++){this._bitrev[s]=0;for(var l=0;l<this._width;l+=2){var f=this._width-l-2;this._bitrev[s]|=(s>>>l&3)<<f}}this._out=null,this._data=null,this._inv=0}return fft=e,e.prototype.fromComplexArray=function(n,r){for(var a=r||new Array(n.length>>>1),o=0;o<n.length;o+=2)a[o>>>1]=n[o];return a},e.prototype.createComplexArray=function(){const n=new Array(this._csize);for(var r=0;r<n.length;r++)n[r]=0;return n},e.prototype.toComplexArray=function(n,r){for(var a=r||this.createComplexArray(),o=0;o<a.length;o+=2)a[o]=n[o>>>1],a[o+1]=0;return a},e.prototype.completeSpectrum=function(n){for(var r=this._csize,a=r>>>1,o=2;o<a;o+=2)n[r-o]=n[o],n[r-o+1]=-n[o+1]},e.prototype.transform=function(n,r){if(n===r)throw new Error("Input and output buffers must be different");this._out=n,this._data=r,this._inv=0,this._transform4(),this._out=null,this._data=null},e.prototype.realTransform=function(n,r){if(n===r)throw new Error("Input and output buffers must be different");this._out=n,this._data=r,this._inv=0,this._realTransform4(),this._out=null,this._data=null},e.prototype.inverseTransform=function(n,r){if(n===r)throw new Error("Input and output buffers must be different");this._out=n,this._data=r,this._inv=1,this._transform4();for(var a=0;a<n.length;a++)n[a]/=this.size;this._out=null,this._data=null},e.prototype._transform4=function(){var n=this._out,r=this._csize,a=this._width,o=1<<a,s=r/o<<1,l,f,p=this._bitrev;if(s===4)for(l=0,f=0;l<r;l+=s,f++){const A=p[f];this._singleTransform2(l,A,o)}else for(l=0,f=0;l<r;l+=s,f++){const A=p[f];this._singleTransform4(l,A,o)}var d=this._inv?-1:1,c=this.table;for(o>>=2;o>=2;o>>=2){s=r/o<<1;var _=s>>>2;for(l=0;l<r;l+=s)for(var $=l+_,h=l,S=0;h<$;h+=2,S+=o){const A=h,O=A+_,m=O+_,u=m+_,g=n[A],b=n[A+1],T=n[O],E=n[O+1],y=n[m],w=n[m+1],P=n[u],N=n[u+1],R=g,C=b,M=c[S],I=d*c[S+1],F=T*M-E*I,k=T*I+E*M,L=c[2*S],V=d*c[2*S+1],D=y*L-w*V,q=y*V+w*L,B=c[3*S],W=d*c[3*S+1],z=P*B-N*W,H=P*W+N*B,j=R+D,U=C+q,J=R-D,Q=C-q,G=F+z,K=k+H,X=d*(F-z),Y=d*(k-H),Z=j+G,ee=U+K,ne=j-G,re=U-K,oe=J+Y,ae=Q-X,se=J-Y,ie=Q+X;n[A]=Z,n[A+1]=ee,n[O]=oe,n[O+1]=ae,n[m]=ne,n[m+1]=re,n[u]=se,n[u+1]=ie}}},e.prototype._singleTransform2=function(n,r,a){const o=this._out,s=this._data,l=s[r],f=s[r+1],p=s[r+a],d=s[r+a+1],c=l+p,_=f+d,$=l-p,h=f-d;o[n]=c,o[n+1]=_,o[n+2]=$,o[n+3]=h},e.prototype._singleTransform4=function(n,r,a){const o=this._out,s=this._data,l=this._inv?-1:1,f=a*2,p=a*3,d=s[r],c=s[r+1],_=s[r+a],$=s[r+a+1],h=s[r+f],S=s[r+f+1],A=s[r+p],O=s[r+p+1],m=d+h,u=c+S,g=d-h,b=c-S,T=_+A,E=$+O,y=l*(_-A),w=l*($-O),P=m+T,N=u+E,R=g+w,C=b-y,M=m-T,I=u-E,F=g-w,k=b+y;o[n]=P,o[n+1]=N,o[n+2]=R,o[n+3]=C,o[n+4]=M,o[n+5]=I,o[n+6]=F,o[n+7]=k},e.prototype._realTransform4=function(){var n=this._out,r=this._csize,a=this._width,o=1<<a,s=r/o<<1,l,f,p=this._bitrev;if(s===4)for(l=0,f=0;l<r;l+=s,f++){const le=p[f];this._singleRealTransform2(l,le>>>1,o>>>1)}else for(l=0,f=0;l<r;l+=s,f++){const le=p[f];this._singleRealTransform4(l,le>>>1,o>>>1)}var d=this._inv?-1:1,c=this.table;for(o>>=2;o>=2;o>>=2){s=r/o<<1;var _=s>>>1,$=_>>>1,h=$>>>1;for(l=0;l<r;l+=s)for(var S=0,A=0;S<=h;S+=2,A+=o){var O=l+S,m=O+$,u=m+$,g=u+$,b=n[O],T=n[O+1],E=n[m],y=n[m+1],w=n[u],P=n[u+1],N=n[g],R=n[g+1],C=b,M=T,I=c[A],F=d*c[A+1],k=E*I-y*F,L=E*F+y*I,V=c[2*A],D=d*c[2*A+1],q=w*V-P*D,B=w*D+P*V,W=c[3*A],z=d*c[3*A+1],H=N*W-R*z,j=N*z+R*W,U=C+q,J=M+B,Q=C-q,G=M-B,K=k+H,X=L+j,Y=d*(k-H),Z=d*(L-j),ee=U+K,ne=J+X,re=Q+Z,oe=G-Y;if(n[O]=ee,n[O+1]=ne,n[m]=re,n[m+1]=oe,S===0){var ae=U-K,se=J-X;n[u]=ae,n[u+1]=se;continue}if(S!==h){var ie=Q,de=-G,fe=U,he=-J,me=-d*Z,ge=-d*Y,ve=-d*X,pe=-d*K,ye=ie+me,we=de+ge,Se=fe+pe,Ae=he-ve,ce=l+$-S,ue=l+_-S;n[ce]=ye,n[ce+1]=we,n[ue]=Se,n[ue+1]=Ae}}}},e.prototype._singleRealTransform2=function(n,r,a){const o=this._out,s=this._data,l=s[r],f=s[r+a],p=l+f,d=l-f;o[n]=p,o[n+1]=0,o[n+2]=d,o[n+3]=0},e.prototype._singleRealTransform4=function(n,r,a){const o=this._out,s=this._data,l=this._inv?-1:1,f=a*2,p=a*3,d=s[r],c=s[r+a],_=s[r+f],$=s[r+p],h=d+_,S=d-_,A=c+$,O=l*(c-$),m=h+A,u=S,g=-O,b=h-A,T=S,E=O;o[n]=m,o[n+1]=0,o[n+2]=u,o[n+3]=g,o[n+4]=b,o[n+5]=0,o[n+6]=T,o[n+7]=E},fft}var fftExports=requireFft();const FFT=getDefaultExportFromCjs(fftExports);var _tmpl$$1=template("<button>Lock: "),_tmpl$2=template("<div><canvas></canvas><div><button>View: ");const midiNoteToFreq=e=>440*Math.pow(2,(e-69)/12),findTriggerIndex=(e,t)=>{for(let n=1;n<t;n++)if(e[n-1]<0&&e[n]>=0)return n;return-1},Oscilloscope=e=>{let t,n;const[r,a]=createSignal("OSCILLOSCOPE"),[o,s]=createSignal(!0),[l,f]=createSignal(2048);let p=null,d=null;const c=4096;let _=null,$=null,h=null;onMount(()=>{_=new FFT(c),$=_.createComplexArray(),h=new Float32Array(c);for(let b=0;b<c;b++)h[b]=.5*(1-Math.cos(2*Math.PI*b/(c-1)));if(!t)return;const m=window.devicePixelRatio||1,u={width:e.width||400,height:e.height||150};n=document.createElement("canvas"),n.width=u.width*m,n.height=u.height*m;const g=n.getContext("2d");g&&(g.scale(m,m),S(g,u.width,u.height))});const S=(m,u,g)=>{const T=getComputedStyle(document.documentElement).getPropertyValue("--dark-purple").trim()||"#2c2a4a",E=20;m.fillStyle=T,m.fillRect(0,0,u,g),m.beginPath(),m.strokeStyle="#606CAE",m.lineWidth=.5;for(let y=E;y<u;y+=E)m.moveTo(y,0),m.lineTo(y,g);for(let y=E;y<g;y+=E)m.moveTo(0,y),m.lineTo(u,y);m.stroke()};createEffect(()=>{const m=e.value?.(),u=r(),g=o();if(!t)return;const b=t.getContext("2d");if(!b)return;const T=window.devicePixelRatio||1,E={width:e.width||400,height:e.height||150};if((t.width!==E.width*T||t.height!==E.height*T)&&(t.width=E.width*T,t.height=E.height*T,t.style.width=`${E.width}px`,t.style.height=`${E.height}px`,b.scale(T,T)),b.clearRect(0,0,E.width,E.height),n?b.drawImage(n,0,0,E.width,E.height):S(b,E.width,E.height),!m||m.length===0){b.beginPath(),b.moveTo(0,E.height/2),b.lineTo(E.width,E.height/2),b.strokeStyle="#888",b.lineWidth=1,b.stroke();return}u==="OSCILLOSCOPE"?A(b,m,g,E.width,E.height):O(b,m,E.width,E.height)});const A=(m,u,g,b,T)=>{const E=e.notes?.()??[];let y;const w=u.length;if(g&&E.length>0){const P=E.reduce((I,F)=>F.noteNumber<I?F.noteNumber:I,E[0].noteNumber),N=midiNoteToFreq(P),R=e.sampleRate()/N,C=Math.min(Math.floor(R*2),w);let M;if(P!==p){p=P;const I=w>C?w-C:1,F=findTriggerIndex(u,I);M=F!==-1?F:0,d=M}else if(d!==null){let I=d;for(;I<w;)I+=R;d=I-w,M=Math.round(d)}else M=0,d=0;M+C>w||M<0?y=u.subarray(0,C):y=u.subarray(M,M+C)}else{p!==null&&(p=null,d=null);const P=Math.min(l(),u.length),N=u.length-P;y=u.subarray(N)}if(y&&y.length>0){const P=T/2,N=T/2,R=b/y.length;m.beginPath(),m.moveTo(0,N-y[0]*P);for(let C=1;C<y.length;C++)m.lineTo(C*R,N-y[C]*P);m.strokeStyle="#f506f7",m.lineWidth=1,m.stroke()}},O=(m,u,g,b)=>{if(!_||!$||!h)return;const T=u.slice(0,c);for(let R=0;R<c;R++)T[R]*=h[R];_.realTransform($,T);const E=c/2,y=c/2,w=-100,P=0;m.fillStyle="#f506f7";let N=0;for(let R=0;R<E;R++){const C=$[R*2],M=$[R*2+1],F=Math.sqrt(C*C+M*M)/y,k=20*Math.log10(F+1e-9),L=R*e.sampleRate()/c,V=20,D=e.sampleRate()/2;let q=g*(Math.log(L/V)/Math.log(D/V)),B=(k-w)/(P-w);B=Math.max(0,Math.min(1,B));const W=(1-B)*b;if(isFinite(q)&&isFinite(W)){const z=Math.max(1,q-N),H=b-W;m.fillRect(N,W,z,H),N=q}}};return(()=>{var m=_tmpl$2(),u=m.firstChild,g=u.nextSibling,b=g.firstChild;b.firstChild,m.style.setProperty("display","flex"),m.style.setProperty("flex-direction","column"),m.style.setProperty("align-items","center"),m.style.setProperty("gap","8px");var T=t;return typeof T=="function"?use(T,u):t=u,u.style.setProperty("border-radius","10px"),u.style.setProperty("border","1px solid var(--teal)"),g.style.setProperty("display","flex"),g.style.setProperty("gap","10px"),b.$$click=()=>a(E=>E==="OSCILLOSCOPE"?"FFT":"OSCILLOSCOPE"),insert(b,r,null),insert(g,createComponent(Show,{get when(){return r()==="OSCILLOSCOPE"},get children(){var E=_tmpl$$1();return E.firstChild,E.$$click=()=>s(!o()),insert(E,()=>o()?"On":"Off",null),E}}),null),createRenderEffect(()=>setAttribute(u,"id",e.id||"oscilloscope")),m})()};delegateEvents(["click"]);var _tmpl$=template('<div class=app-container><div class="d-flex flex-row"><div class=intro><span class=title>The Synth</span><p>Use your keyboard, MIDI, or click the keys below.</p></div></div><div id=synth-container><div class="controls-container d-flex flex-col flex-xxl-row"><div class="controls-top-row d-flex flex-col flex-md-row flex-xxl-col"><div class=matrix-master-container><div class="parameter-container master-volume-container flex-row"><label class=parameter-title>Master Volume</label></div></div></div><div id=operator-controls> </div></div><div class="d-flex flex-row">');const[appStore,setAppStore]=createStore(createDefaultAppState()),[isFineModeActive,setIsFineModeActive]=createSignal(!1),App=()=>{let e=null;const[t,n]=createSignal(!1),[r,a]=createSignal(appStore.masterVolume),[o,s]=createSignal(null),[l,f]=createSignal([]),[p,d]=createSignal(44100);createEffect(()=>{a(appStore.masterVolume)});const c=async()=>{console.log("App: Initializing Audio and Synth...");try{const A=getAudioContext();console.log("App: Fetching Wasm binary...");const O=await fetch("./pkg/rustfmsynth_bg.wasm");if(!O.ok)throw new Error("Failed to fetch Wasm binary.");const m=await O.arrayBuffer();console.log("App: Wasm binary fetched."),await addAudioWorkletModule("./synth-processor.js"),e=createAudioWorkletNode("synth-processor",{numberOfOutputs:1}),e.port.onmessage=u=>{u.data?.type==="initialized"?(console.log("App: Received 'initialized' confirmation from worklet."),n(!0)):u.data?.type==="init_error"?console.error("App: Received initialization error from worklet:",u.data.error):u.data?.type==="processing_error"?console.warn("App: Received processing error from worklet:",u.data.error,"for message:",u.data.messageType):u.data?.type==="output"?s(u.data.data):console.log("App: Received message from worklet:",u.data)},e.port.onmessageerror=u=>{console.error("App: Error receiving message from worklet:",u)},initializeSynthInputHandler(e.port),console.log("App: Sending 'init' message with Wasm binary to processor..."),e.port.postMessage({type:"init",sampleRate:A.sampleRate,wasmBinary:m},[m]),d(A.sampleRate),e.connect(A.destination),console.log("App: Processor node connected to destination."),console.log("App: Synth initialization sequence complete. Waiting for 'initialized' confirmation.")}catch(A){console.error("App: Error during synthesizer initialization:",A),e=null}},_=A=>{setAppStore("masterVolume",A),setMasterVolume(A)},$=A=>{A.key==="Shift"&&!A.repeat&&!isFineModeActive()&&(setIsFineModeActive(!0),document.body.classList.contains("dial-dragging-active")||(document.body.style.cursor="cell"))},h=A=>{A.key==="Shift"&&isFineModeActive()&&(setIsFineModeActive(!1),document.body.classList.contains("dial-dragging-active")||(document.body.style.cursor=""))};onMount(()=>{window.addEventListener("keydown",$),window.addEventListener("keyup",h),c(),new MidiInputHandler}),onCleanup(()=>{console.log("App: Cleaning up..."),window.removeEventListener("keydown",$),window.removeEventListener("keyup",h),closeAudioContext(),initializeSynthInputHandler(null),e=null}),createEffect(()=>{if(!t()){console.log("App: Skipping synth update, synth not ready.");return}const O=window.location.hash.slice(1);if(O)try{const m=deserializeState(O);m&&(setAppStore(m),history.replaceState(null,"",window.location.pathname))}catch(m){console.error("Failed to parse URL state",m)}setSynthState(unwrap(appStore))});const S=()=>Array.from({length:NUM_OPERATORS},(A,O)=>O);return(()=>{var A=_tmpl$(),O=A.firstChild,m=O.nextSibling,u=m.firstChild,g=u.firstChild,b=g.firstChild,T=b.firstChild;T.firstChild;var E=g.nextSibling;return E.firstChild,u.nextSibling,O.style.setProperty("align-items","center"),O.style.setProperty("justify-content","center"),insert(T,createComponent(Dial,{label:"Master Volume",id:"master-volume-control",value:r,onChange:_,isFineModeActive,minVal:MASTER_VOLUME_MIN,maxVal:MASTER_VOLUME_MAX,valueDisplayFormatter:y=>y.toFixed(0)+"%"}),null),insert(b,createComponent(AlgorithmMatrix,{numOperators:NUM_OPERATORS,get algorithm(){return appStore.algorithm},setAlgorithmState:y=>setAppStore("algorithm",y)}),null),insert(g,createComponent(PatchManager,{}),null),insert(E,createComponent(For,{get each(){return S()},children:y=>createComponent(OperatorControl,{operatorIndex:y,isFineModeActive})}),null),insert(m,createComponent(Oscilloscope,{id:"oscilloscope",value:o,notes:l,sampleRate:p}),null),insert(m,createComponent(KeyboardUI,{initialStartNote:48,activeNotes:l,setActiveNotes:f}),null),A})()},root=document.getElementById("synth");render(()=>createComponent(App,{}),root);
